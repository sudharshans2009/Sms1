<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amrita Vidyalayam Ettimadai - Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: #1a5276;
            --secondary-color: #2980b9;
            --accent-color: #3498db;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            width: 100%;
            max-width: 450px;
        }

        .login-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .login-body {
            padding: 30px;
        }

        .login-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .login-option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .login-option.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .login-option i {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .dashboard-container {
            display: none;
            min-height: 100vh;
            background-color: #f5f7fa;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 250px;
            background-color: var(--dark-color);
            color: white;
            padding-top: 20px;
            overflow-y: auto;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            background-color: var(--primary-color);
            text-align: center;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sidebar-menu li:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu li.active {
            background-color: var(--accent-color);
        }

        .sidebar-menu li i {
            margin-right: 10px;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            min-height: 100vh;
        }

        .top-navbar {
            background-color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .content-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .btn-primary-custom {
            background-color: var(--primary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-primary-custom:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }

        .table-container {
            overflow-x: auto;
        }

        .table-custom {
            border-collapse: separate;
            border-spacing: 0 10px;
        }

        .table-custom thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px;
        }

        .table-custom tbody tr {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .table-custom tbody td {
            padding: 15px;
            vertical-align: middle;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        .bus-map {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
        }

        .announcement-card {
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
            border-radius: 0 5px 5px 0;
        }

        .announcement-card.urgent {
            border-left-color: var(--danger-color);
            background-color: #fff5f5;
        }

        .timetable-slot {
            border: 1px solid #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .timetable-slot:hover {
            background-color: #f0f8ff;
            border-color: var(--accent-color);
        }

        .mark-input {
            width: 70px;
            text-align: center;
        }

        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
        }

        .attendance-item {
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .attendance-item.present {
            background-color: #d4edda;
            border-color: var(--success-color);
        }

        .attendance-item.absent {
            background-color: #f8d7da;
            border-color: var(--danger-color);
        }

        .mobile-toggle {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--accent-color);
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }

        .mobile-menu {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            padding: 10px;
            display: none;
            z-index: 1000;
        }

        .mobile-menu button {
            display: block;
            width: 100%;
            padding: 10px 15px;
            border: none;
            background: none;
            text-align: left;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .mobile-menu button:hover {
            background-color: #f0f0f0;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .mobile-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .login-options {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }

        .tab-navigation {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            border-bottom-color: var(--accent-color);
            color: var(--accent-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-container select,
        .filter-container input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .event-card {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .event-image {
            height: 200px;
            background-size: cover;
            background-position: center;
        }

        .event-details {
            padding: 20px;
        }

        .event-date {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent-color);
        }

        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .activity-content {
            flex-grow: 1;
        }

        .activity-time {
            font-size: 0.8rem;
            color: #888;
        }

        .grade-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 5px;
        }

        .grade-A { background-color: #d4edda; color: #155724; }
        .grade-B { background-color: #cce5ff; color: #004085; }
        .grade-C { background-color: #fff3cd; color: #856404; }
        .grade-D { background-color: #f8d7da; color: #721c24; }

        .smart-screen {
            background-color: #000;
            color: #fff;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .smart-screen-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }

        .smart-screen-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .smart-screen-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .smart-screen button {
            background-color: #444;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .smart-screen button:hover {
            background-color: #666;
        }

        .report-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .comment {
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .comment:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .comment-author {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .comment-text {
            font-size: 0.9rem;
        }

        .comment-date {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h3>Amrita Vidyalayam Ettimadai</h3>
                <p>Management System</p>
            </div>
            <div class="login-body">
                <div class="login-options">
                    <div class="login-option" data-role="admin">
                        <i class="bi bi-shield-lock"></i>
                        <span>Admin</span>
                    </div>
                    <div class="login-option" data-role="teacher">
                        <i class="bi bi-person-workspace"></i>
                        <span>Teacher</span>
                    </div>
                    <div class="login-option" data-role="student">
                        <i class="bi bi-mortarboard"></i>
                        <span>Student</span>
                    </div>
                    <div class="login-option" data-role="driver">
                        <i class="bi bi-bus-front"></i>
                        <span>Driver</span>
                    </div>
                </div>
                <div id="loginForm" style="display: none;">
                    <div class="error-message" id="loginError">Invalid email or password</div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" placeholder="Enter your email">
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" placeholder="Enter your password">
                    </div>
                    <button class="btn btn-primary-custom w-100" id="loginBtn">Login</button>
                    <div class="text-center mt-3">
                        <a href="#" class="text-decoration-none">Forgot Password?</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboardPage" class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4>Amrita Vidyalayam</h4>
                <p id="userRole">User</p>
            </div>
            <ul class="sidebar-menu" id="sidebarMenu">
                <!-- Menu items will be populated based on user role -->
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navbar -->
            <div class="top-navbar">
                <div class="d-flex align-items-center">
                    <button class="btn btn-sm btn-light me-3 d-md-none" id="sidebarToggle">
                        <i class="bi bi-list"></i>
                    </button>
                    <h4 id="pageTitle">Dashboard</h4>
                </div>
                <div class="d-flex align-items-center">
                    <div class="position-relative me-3">
                        <i class="bi bi-bell fs-5"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="https://picsum.photos/seed/user123/40/40.jpg" alt="User" class="rounded-circle me-2" width="30" height="30">
                            <span id="userName">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" id="profileLink">Profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Page Content -->
            <div id="pageContent">
                <!-- Content will be loaded here based on selected menu item -->
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <button class="mobile-toggle" id="mobileToggle">
        <i class="bi bi-list fs-4"></i>
    </button>
    <div class="mobile-menu" id="mobileMenu">
        <!-- Mobile menu items will be populated based on user role -->
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Application State
        const app = {
            currentUser: null,
            userRole: null,
            currentPage: 'dashboard',
            students: [],
            teachers: [],
            classes: [],
            buses: [],
            announcements: [],
            events: [],
            reports: [],
            attendance: [],
            marks: [],
            timetables: [],
            busLocations: {}
        };

        // Initialize sample data
        function initializeSampleData() {
            // Sample students
            for (let i = 1; i <= 50; i++) {
                const grade = Math.floor(Math.random() * 12) + 1;
                const section = grade <= 10 ? 
                    ['A', 'B', 'C', 'D'][Math.floor(Math.random() * 4)] : 
                    ['A', 'B', 'C'][Math.floor(Math.random() * 3)];
                
                app.students.push({
                    id: `STU${i.toString().padStart(4, '0')}`,
                    name: `Student ${i}`,
                    email: `student${i}@amrita.edu`,
                    phone: `9876543${i.toString().padStart(4, '0')}`,
                    grade: grade,
                    section: section,
                    parentEmail: `parent${i}@email.com`,
                    parentPhone: `9876543${(i+1000).toString().padStart(4, '0')}`,
                    transport: Math.random() > 0.3 ? 
                        (Math.random() > 0.5 ? `AV${Math.floor(Math.random() * 12) + 1}` : `P${Math.floor(Math.random() * 3) + 1}`) : 
                        'Local',
                    address: `Address ${i}, Ettimadai`,
                    admissionDate: `201${Math.floor(Math.random() * 4)}-0${Math.floor(Math.random() * 9) + 1}-15`,
                    bloodGroup: ['A+', 'A-', 'B+', 'B-', 'O+', 'O-', 'AB+', 'AB-'][Math.floor(Math.random() * 8)],
                    dob: `200${Math.floor(Math.random() * 10)}-0${Math.floor(Math.random() * 9) + 1}-15`,
                    gender: Math.random() > 0.5 ? 'Male' : 'Female'
                });
            }

            // Sample teachers
            const subjects = ['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'];
            for (let i = 1; i <= 20; i++) {
                app.teachers.push({
                    id: `TCH${i.toString().padStart(4, '0')}`,
                    name: `Teacher ${i}`,
                    email: `teacher${i}@amrita.edu`,
                    phone: `9876543${(i+2000).toString().padStart(4, '0')}`,
                    subject: subjects[Math.floor(Math.random() * subjects.length)],
                    qualification: ['M.Sc', 'M.A', 'B.Ed', 'M.Phil', 'Ph.D'][Math.floor(Math.random() * 5)],
                    experience: Math.floor(Math.random() * 20) + 1,
                    address: `Teacher Address ${i}, Ettimadai`,
                    joinDate: `201${Math.floor(Math.random() * 4)}-0${Math.floor(Math.random() * 9) + 1}-15`,
                    classes: []
                });
            }

            // Sample classes
            for (let grade = 1; grade <= 12; grade++) {
                const sections = grade <= 10 ? ['A', 'B', 'C', 'D'] : ['A', 'B', 'C'];
                sections.forEach(section => {
                    app.classes.push({
                        id: `${grade}-${section}`,
                        grade: grade,
                        section: section,
                        classTeacher: app.teachers[Math.floor(Math.random() * app.teachers.length)].id,
                        classHead: app.teachers[Math.floor(Math.random() * app.teachers.length)].id,
                        roomNumber: `${Math.floor(Math.random() * 50) + 100}`,
                        students: app.students.filter(s => s.grade === grade && s.section === section).map(s => s.id)
                    });
                });
            }

            // Sample buses
            for (let i = 1; i <= 12; i++) {
                app.buses.push({
                    id: `AV${i}`,
                    type: 'School',
                    driver: `Driver ${i}`,
                    driverPhone: `9876543${(i+3000).toString().padStart(4, '0')}`,
                    capacity: 40,
                    route: `Route ${i}`,
                    students: app.students.filter(s => s.transport === `AV${i}`).map(s => s.id)
                });
            }

            for (let i = 1; i <= 3; i++) {
                app.buses.push({
                    id: `P${i}`,
                    type: 'Private',
                    driver: `Private Driver ${i}`,
                    driverPhone: `9876543${(i+4000).toString().padStart(4, '0')}`,
                    capacity: 30,
                    route: `Private Route ${i}`,
                    students: app.students.filter(s => s.transport === `P${i}`).map(s => s.id)
                });
            }

            // Sample announcements
            app.announcements = [
                {
                    id: 1,
                    title: 'School Annual Day',
                    content: 'The annual day celebration will be held on 15th August 2023. All students are required to attend.',
                    date: '2023-07-15',
                    urgent: true,
                    target: 'all'
                },
                {
                    id: 2,
                    title: 'PTA Meeting',
                    content: 'Parent-Teacher meeting for classes 1-5 will be held on 20th July 2023.',
                    date: '2023-07-10',
                    urgent: false,
                    target: '1-5'
                },
                {
                    id: 3,
                    title: 'Holiday Notice',
                    content: 'School will remain closed on 2nd October 2023 on account of Gandhi Jayanti.',
                    date: '2023-09-25',
                    urgent: false,
                    target: 'all'
                }
            ];

            // Sample events
            app.events = [
                {
                    id: 1,
                    title: 'Science Exhibition',
                    description: 'Annual science exhibition for classes 6-12',
                    date: '2023-08-15',
                    time: '9:00 AM',
                    location: 'School Auditorium',
                    image: 'https://picsum.photos/seed/science/800/400.jpg'
                },
                {
                    id: 2,
                    title: 'Sports Day',
                    description: 'Annual sports meet for all classes',
                    date: '2023-09-10',
                    time: '8:00 AM',
                    location: 'School Ground',
                    image: 'https://picsum.photos/seed/sports/800/400.jpg'
                },
                {
                    id: 3,
                    title: 'Cultural Fest',
                    description: 'Inter-school cultural competition',
                    date: '2023-10-20',
                    time: '10:00 AM',
                    location: 'School Auditorium',
                    image: 'https://picsum.photos/seed/cultural/800/400.jpg'
                }
            ];

            // Sample timetables
            const periods = ['9:00-9:45', '9:45-10:30', '10:45-11:30', '11:30-12:15', '1:00-1:45', '1:45-2:30', '2:30-3:15'];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            for (let classId of app.classes.map(c => c.id)) {
                const timetable = {};
                days.forEach(day => {
                    timetable[day] = {};
                    periods.forEach(period => {
                        timetable[day][period] = subjects[Math.floor(Math.random() * subjects.length)];
                    });
                });
                app.timetables.push({
                    classId: classId,
                    timetable: timetable
                });
            }
        }

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboardPage = document.getElementById('dashboardPage');
        const loginOptions = document.querySelectorAll('.login-option');
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarMenu = document.getElementById('sidebarMenu');
        const pageTitle = document.getElementById('pageTitle');
        const pageContent = document.getElementById('pageContent');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mobileToggle = document.getElementById('mobileToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const userRole = document.getElementById('userRole');
        const userName = document.getElementById('userName');
        const profileLink = document.getElementById('profileLink');

        // Event Listeners
        loginOptions.forEach(option => {
            option.addEventListener('click', function() {
                loginOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                app.userRole = this.dataset.role;
                loginForm.style.display = 'block';
                document.getElementById('loginError').style.display = 'none';
            });
        });

        loginBtn.addEventListener('click', handleLogin);
        logoutBtn.addEventListener('click', handleLogout);
        sidebarToggle.addEventListener('click', toggleSidebar);
        mobileToggle.addEventListener('click', toggleMobileMenu);
        profileLink.addEventListener('click', () => loadPage('profile'));

        // Functions
        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simple validation for demo purposes
            if (!email || !password) {
                document.getElementById('loginError').style.display = 'block';
                return;
            }
            
            // Set current user based on role
            app.currentUser = {
                email: email,
                role: app.userRole,
                name: app.userRole.charAt(0).toUpperCase() + app.userRole.slice(1) + ' User'
            };
            
            // Update UI
            userRole.textContent = app.userRole.charAt(0).toUpperCase() + app.userRole.slice(1);
            userName.textContent = app.currentUser.name;
            
            // Show dashboard
            loginPage.style.display = 'none';
            dashboardPage.style.display = 'block';
            
            // Load menu and dashboard
            loadMenu();
            loadPage('dashboard');
        }

        function handleLogout() {
            app.currentUser = null;
            app.userRole = null;
            
            // Reset login form
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            loginForm.style.display = 'none';
            loginOptions.forEach(opt => opt.classList.remove('active'));
            
            // Show login page
            dashboardPage.style.display = 'none';
            loginPage.style.display = 'block';
        }

        function toggleSidebar() {
            sidebar.classList.toggle('active');
        }

        function toggleMobileMenu() {
            if (mobileMenu.style.display === 'block') {
                mobileMenu.style.display = 'none';
            } else {
                mobileMenu.style.display = 'block';
                loadMobileMenu();
            }
        }

        function loadMenu() {
            sidebarMenu.innerHTML = '';
            
            // Common menu items for all roles
            const commonItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'bi-speedometer2' },
                { id: 'profile', label: 'Profile', icon: 'bi-person' },
                { id: 'announcements', label: 'Announcements', icon: 'bi-megaphone' },
                { id: 'events', label: 'Events', icon: 'bi-calendar-event' }
            ];
            
            // Role-specific menu items
            let roleItems = [];
            
            if (app.userRole === 'admin') {
                roleItems = [
                    { id: 'students', label: 'Students', icon: 'bi-people' },
                    { id: 'teachers', label: 'Teachers', icon: 'bi-person-workspace' },
                    { id: 'classes', label: 'Classes', icon: 'bi-house-door' },
                    { id: 'attendance', label: 'Attendance', icon: 'bi-check2-square' },
                    { id: 'marks', label: 'Marks', icon: 'bi-award' },
                    { id: 'timetable', label: 'Timetable', icon: 'bi-calendar-week' },
                    { id: 'reports', label: 'Reports', icon: 'bi-file-text' },
                    { id: 'buses', label: 'Bus Management', icon: 'bi-bus-front' },
                    { id: 'smart-screen', label: 'Smart Screen', icon: 'bi-tv' },
                    { id: 'library', label: 'Library', icon: 'bi-book' },
                    { id: 'inventory', label: 'Inventory', icon: 'bi-box' },
                    { id: 'settings', label: 'Settings', icon: 'bi-gear' }
                ];
            } else if (app.userRole === 'teacher') {
                roleItems = [
                    { id: 'my-classes', label: 'My Classes', icon: 'bi-house-door' },
                    { id: 'attendance', label: 'Attendance', icon: 'bi-check2-square' },
                    { id: 'marks', label: 'Marks', icon: 'bi-award' },
                    { id: 'timetable', label: 'Timetable', icon: 'bi-calendar-week' },
                    { id: 'reports', label: 'Reports', icon: 'bi-file-text' },
                    { id: 'communication', label: 'Communication', icon: 'bi-chat-dots' }
                ];
            } else if (app.userRole === 'student') {
                roleItems = [
                    { id: 'my-details', label: 'My Details', icon: 'bi-person-badge' },
                    { id: 'attendance', label: 'Attendance', icon: 'bi-check2-square' },
                    { id: 'marks', label: 'Marks', icon: 'bi-award' },
                    { id: 'timetable', label: 'Timetable', icon: 'bi-calendar-week' },
                    { id: 'bus-tracking', label: 'Bus Tracking', icon: 'bi-geo-alt' },
                    { id: 'assignments', label: 'Assignments', icon: 'bi-journal-text' }
                ];
            } else if (app.userRole === 'driver') {
                roleItems = [
                    { id: 'bus-tracking', label: 'Share Location', icon: 'bi-geo-alt' }
                ];
            }
            
            // Combine and render menu items
            const allItems = [...commonItems, ...roleItems];
            allItems.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="bi ${item.icon}"></i> ${item.label}`;
                li.addEventListener('click', () => loadPage(item.id));
                sidebarMenu.appendChild(li);
            });
        }

        function loadMobileMenu() {
            mobileMenu.innerHTML = '';
            
            // Get menu items from sidebar
            const menuItems = Array.from(sidebarMenu.children);
            menuItems.forEach(item => {
                const button = document.createElement('button');
                button.innerHTML = item.innerHTML;
                button.addEventListener('click', () => {
                    const text = item.textContent.trim();
                    const pageId = text.toLowerCase().replace(' ', '-');
                    loadPage(pageId);
                    mobileMenu.style.display = 'none';
                });
                mobileMenu.appendChild(button);
            });
        }

        function loadPage(pageId) {
            app.currentPage = pageId;
            
            // Update active menu item
            const menuItems = document.querySelectorAll('.sidebar-menu li');
            menuItems.forEach(item => {
                item.classList.remove('active');
                if (item.textContent.trim().toLowerCase().replace(' ', '-') === pageId) {
                    item.classList.add('active');
                }
            });
            
            // Update page title
            const titleText = pageId.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            pageTitle.textContent = titleText;
            
            // Load page content based on pageId
            switch(pageId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'profile':
                    loadProfile();
                    break;
                case 'students':
                    loadStudents();
                    break;
                case 'teachers':
                    loadTeachers();
                    break;
                case 'classes':
                    loadClasses();
                    break;
                case 'attendance':
                    loadAttendance();
                    break;
                case 'marks':
                    loadMarks();
                    break;
                case 'timetable':
                    loadTimetable();
                    break;
                case 'announcements':
                    loadAnnouncements();
                    break;
                case 'events':
                    loadEvents();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'buses':
                    loadBuses();
                    break;
                case 'bus-tracking':
                    loadBusTracking();
                    break;
                case 'smart-screen':
                    loadSmartScreen();
                    break;
                case 'library':
                    loadLibrary();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'settings':
                    loadSettings();
                    break;
                case 'my-classes':
                    loadMyClasses();
                    break;
                case 'communication':
                    loadCommunication();
                    break;
                case 'my-details':
                    loadMyDetails();
                    break;
                case 'assignments':
                    loadAssignments();
                    break;
                default:
                    pageContent.innerHTML = '<div class="content-card"><p>Page under construction</p></div>';
            }
        }

        function loadDashboard() {
            let content = `
                <div class="row mb-4">
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-primary text-white">
                                <i class="bi bi-people"></i>
                            </div>
                            <h3>${app.students.length}</h3>
                            <p>Total Students</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-success text-white">
                                <i class="bi bi-person-workspace"></i>
                            </div>
                            <h3>${app.teachers.length}</h3>
                            <p>Total Teachers</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-warning text-white">
                                <i class="bi bi-house-door"></i>
                            </div>
                            <h3>${app.classes.length}</h3>
                            <p>Total Classes</p>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-info text-white">
                                <i class="bi bi-bus-front"></i>
                            </div>
                            <h3>${app.buses.length}</h3>
                            <p>Total Buses</p>
                        </div>
                    </div>
                </div>
            `;
            
            if (app.userRole === 'admin') {
                content += `
                    <div class="row">
                        <div class="col-md-8 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">Student Distribution</h5>
                                <div class="chart-container">
                                    <canvas id="studentChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">Recent Activities</h5>
                                <div class="activity-feed">
                                    <div class="activity-item">
                                        <div class="activity-icon bg-primary text-white">
                                            <i class="bi bi-person-plus"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div>New student admitted</div>
                                            <div class="activity-time">2 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon bg-success text-white">
                                            <i class="bi bi-check-circle"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div>Attendance marked for Class 5-A</div>
                                            <div class="activity-time">5 hours ago</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon bg-warning text-white">
                                            <i class="bi bi-exclamation-triangle"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div>Bus AV3 running late</div>
                                            <div class="activity-time">1 day ago</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">Upcoming Events</h5>
                                <div class="list-group">
                                    ${app.events.slice(0, 3).map(event => `
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">${event.title}</h6>
                                                <small>${event.date}</small>
                                            </div>
                                            <p class="mb-1">${event.description}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">Latest Announcements</h5>
                                ${app.announcements.slice(0, 3).map(announcement => `
                                    <div class="announcement-card ${announcement.urgent ? 'urgent' : ''}">
                                        <h6>${announcement.title}</h6>
                                        <p>${announcement.content}</p>
                                        <small>${announcement.date}</small>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.userRole === 'teacher') {
                content += `
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">My Classes</h5>
                                <div class="list-group">
                                    ${app.classes.slice(0, 3).map(cls => `
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">Class ${cls.grade}-${cls.section}</h6>
                                                <small>${cls.students.length} students</small>
                                            </div>
                                            <p class="mb-1">Room: ${cls.roomNumber}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">Today's Schedule</h5>
                                <div class="list-group">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Class 5-A - Mathematics</h6>
                                            <small>9:00 AM</small>
                                        </div>
                                        <p class="mb-1">Room: 201</p>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Class 5-B - Mathematics</h6>
                                            <small>10:00 AM</small>
                                        </div>
                                        <p class="mb-1">Room: 202</p>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Staff Meeting</h6>
                                            <small>2:00 PM</small>
                                        </div>
                                        <p class="mb-1">Staff Room</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.userRole === 'student') {
                const student = app.students[0]; // Get first student for demo
                content += `
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">My Timetable</h5>
                                <div class="list-group">
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Mathematics</h6>
                                            <small>9:00 AM</small>
                                        </div>
                                        <p class="mb-1">Room: 201</p>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">Science</h6>
                                            <small>10:00 AM</small>
                                        </div>
                                        <p class="mb-1">Room: 205</p>
                                    </div>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h6 class="mb-1">English</h6>
                                            <small>11:00 AM</small>
                                        </div>
                                        <p class="mb-1">Room: 203</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="content-card">
                                <h5 class="mb-3">My Bus</h5>
                                <div class="d-flex align-items-center mb-3">
                                    <i class="bi bi-bus-front fs-1 me-3"></i>
                                    <div>
                                        <h6>${student.transport}</h6>
                                        <p>Driver: ${app.buses.find(b => b.id === student.transport)?.driver || 'N/A'}</p>
                                    </div>
                                </div>
                                <button class="btn btn-primary-custom w-100" onclick="loadPage('bus-tracking')">
                                    <i class="bi bi-geo-alt me-2"></i>Track Bus
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.userRole === 'driver') {
                content += `
                    <div class="row">
                        <div class="col-12">
                            <div class="content-card">
                                <h5 class="mb-3">Share Your Location</h5>
                                <p class="mb-4">Click the button below to share your live location with students and parents.</p>
                                <button class="btn btn-primary-custom w-100" onclick="startLocationSharing()">
                                    <i class="bi bi-geo-alt me-2"></i>Start Sharing Location
                                </button>
                                <div id="locationStatus" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            pageContent.innerHTML = content;
            
            // Initialize chart if admin
            if (app.userRole === 'admin') {
                setTimeout(() => {
                    const ctx = document.getElementById('studentChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Class 1-5', 'Class 6-8', 'Class 9-10', 'Class 11-12'],
                            datasets: [{
                                label: 'Number of Students',
                                data: [
                                    app.students.filter(s => s.grade >= 1 && s.grade <= 5).length,
                                    app.students.filter(s => s.grade >= 6 && s.grade <= 8).length,
                                    app.students.filter(s => s.grade >= 9 && s.grade <= 10).length,
                                    app.students.filter(s => s.grade >= 11 && s.grade <= 12).length
                                ],
                                backgroundColor: [
                                    'rgba(54, 162, 235, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(255, 99, 132, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(255, 99, 132, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }, 100);
            }
        }

        function loadProfile() {
            const content = `
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <div class="content-card text-center">
                            <img src="https://picsum.photos/seed/${app.currentUser.email}/200/200.jpg" alt="Profile" class="profile-avatar mb-3">
                            <h4>${app.currentUser.name}</h4>
                            <p class="text-muted">${app.userRole.charAt(0).toUpperCase() + app.userRole.slice(1)}</p>
                            <p class="text-muted">${app.currentUser.email}</p>
                            <button class="btn btn-primary-custom">Change Photo</button>
                        </div>
                    </div>
                    <div class="col-md-8 mb-4">
                        <div class="content-card">
                            <h5 class="mb-3">Personal Information</h5>
                            <form>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="firstName" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="firstName" value="${app.currentUser.name.split(' ')[0]}">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="lastName" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="lastName" value="${app.currentUser.name.split(' ')[1] || ''}">
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="email" value="${app.currentUser.email}">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">Phone</label>
                                        <input type="tel" class="form-control" id="phone" value="9876543210">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" id="address" rows="3">123, Ettimadai, Coimbatore</textarea>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-secondary me-2">Cancel</button>
                                    <button type="button" class="btn btn-primary-custom">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="content-card">
                            <h5 class="mb-3">Change Password</h5>
                            <form>
                                <div class="row mb-3">
                                    <div class="col-md-4">
                                        <label for="currentPassword" class="form-label">Current Password</label>
                                        <input type="password" class="form-control" id="currentPassword">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="newPassword" class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="newPassword">
                                    </div>
                                    <div class="col-md-4">
                                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                                        <input type="password" class="form-control" id="confirmPassword">
                                    </div>
                                </div>
                                <div class="d-flex justify-content-end">
                                    <button type="button" class="btn btn-primary-custom">Update Password</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadStudents() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Students Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('students')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addStudentModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Student
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="gradeFilter">
                            <option value="">All Grades</option>
                            ${Array.from({length: 12}, (_, i) => i + 1).map(grade => 
                                `<option value="${grade}">Class ${grade}</option>`
                            ).join('')}
                        </select>
                        <select class="form-select" id="sectionFilter">
                            <option value="">All Sections</option>
                            <option value="A">Section A</option>
                            <option value="B">Section B</option>
                            <option value="C">Section C</option>
                            <option value="D">Section D</option>
                        </select>
                        <input type="text" class="form-control" id="searchStudent" placeholder="Search by name or ID">
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Grade</th>
                                    <th>Section</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Transport</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${app.students.map(student => `
                                    <tr>
                                        <td>${student.id}</td>
                                        <td>${student.name}</td>
                                        <td>${student.grade}</td>
                                        <td>${student.section}</td>
                                        <td>${student.email}</td>
                                        <td>${student.phone}</td>
                                        <td>${student.transport}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewStudent('${student.id}')">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editStudent('${student.id}')">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent('${student.id}')">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Student Modal -->
                <div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addStudentModalLabel">Add New Student</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addStudentForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="studentName" class="form-label">Student Name</label>
                                            <input type="text" class="form-control" id="studentName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="studentEmail" class="form-label">Student Email</label>
                                            <input type="email" class="form-control" id="studentEmail" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="studentPhone" class="form-label">Student Phone</label>
                                            <input type="tel" class="form-control" id="studentPhone" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="studentGrade" class="form-label">Grade</label>
                                            <select class="form-select" id="studentGrade" required>
                                                ${Array.from({length: 12}, (_, i) => i + 1).map(grade => 
                                                    `<option value="${grade}">Class ${grade}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="studentSection" class="form-label">Section</label>
                                            <select class="form-select" id="studentSection" required>
                                                <option value="A">Section A</option>
                                                <option value="B">Section B</option>
                                                <option value="C">Section C</option>
                                                <option value="D">Section D</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="studentTransport" class="form-label">Transport</label>
                                            <select class="form-select" id="studentTransport" required>
                                                <option value="Local">Local</option>
                                                ${app.buses.filter(b => b.type === 'School').map(bus => 
                                                    `<option value="${bus.id}">${bus.id} (School)</option>`
                                                ).join('')}
                                                ${app.buses.filter(b => b.type === 'Private').map(bus => 
                                                    `<option value="${bus.id}">${bus.id} (Private)</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="parentEmail" class="form-label">Parent Email</label>
                                            <input type="email" class="form-control" id="parentEmail" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="parentPhone" class="form-label">Parent Phone</label>
                                            <input type="tel" class="form-control" id="parentPhone" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="studentAddress" class="form-label">Address</label>
                                        <textarea class="form-control" id="studentAddress" rows="3" required></textarea>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-4">
                                            <label for="studentDOB" class="form-label">Date of Birth</label>
                                            <input type="date" class="form-control" id="studentDOB" required>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="studentGender" class="form-label">Gender</label>
                                            <select class="form-select" id="studentGender" required>
                                                <option value="Male">Male</option>
                                                <option value="Female">Female</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label for="studentBloodGroup" class="form-label">Blood Group</label>
                                            <select class="form-select" id="studentBloodGroup" required>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveStudent()">Save Student</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners for filters
            document.getElementById('gradeFilter').addEventListener('change', filterStudents);
            document.getElementById('sectionFilter').addEventListener('change', filterStudents);
            document.getElementById('searchStudent').addEventListener('input', filterStudents);
        }

        function loadTeachers() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Teachers Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('teachers')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addTeacherModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Teacher
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="subjectFilter">
                            <option value="">All Subjects</option>
                            ${['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'].map(subject => 
                                `<option value="${subject}">${subject}</option>`
                            ).join('')}
                        </select>
                        <input type="text" class="form-control" id="searchTeacher" placeholder="Search by name or ID">
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Subject</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Qualification</th>
                                    <th>Experience</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${app.teachers.map(teacher => `
                                    <tr>
                                        <td>${teacher.id}</td>
                                        <td>${teacher.name}</td>
                                        <td>${teacher.subject}</td>
                                        <td>${teacher.email}</td>
                                        <td>${teacher.phone}</td>
                                        <td>${teacher.qualification}</td>
                                        <td>${teacher.experience} years</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewTeacher('${teacher.id}')">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editTeacher('${teacher.id}')">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTeacher('${teacher.id}')">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Teacher Modal -->
                <div class="modal fade" id="addTeacherModal" tabindex="-1" aria-labelledby="addTeacherModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addTeacherModalLabel">Add New Teacher</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addTeacherForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="teacherName" class="form-label">Teacher Name</label>
                                            <input type="text" class="form-control" id="teacherName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="teacherEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="teacherEmail" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="teacherPhone" class="form-label">Phone</label>
                                            <input type="tel" class="form-control" id="teacherPhone" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="teacherSubject" class="form-label">Subject</label>
                                            <select class="form-select" id="teacherSubject" required>
                                                ${['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'].map(subject => 
                                                    `<option value="${subject}">${subject}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="teacherQualification" class="form-label">Qualification</label>
                                            <input type="text" class="form-control" id="teacherQualification" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="teacherExperience" class="form-label">Experience (years)</label>
                                            <input type="number" class="form-control" id="teacherExperience" min="0" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="teacherAddress" class="form-label">Address</label>
                                        <textarea class="form-control" id="teacherAddress" rows="3" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="teacherJoinDate" class="form-label">Join Date</label>
                                        <input type="date" class="form-control" id="teacherJoinDate" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveTeacher()">Save Teacher</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners for filters
            document.getElementById('subjectFilter').addEventListener('change', filterTeachers);
            document.getElementById('searchTeacher').addEventListener('input', filterTeachers);
        }

        function loadClasses() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Classes Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('classes')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addClassModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Class
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="classGradeFilter">
                            <option value="">All Grades</option>
                            ${Array.from({length: 12}, (_, i) => i + 1).map(grade => 
                                `<option value="${grade}">Class ${grade}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Class</th>
                                    <th>Section</th>
                                    <th>Class Teacher</th>
                                    <th>Class Head</th>
                                    <th>Room Number</th>
                                    <th>Students Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${app.classes.map(cls => {
                                    const classTeacher = app.teachers.find(t => t.id === cls.classTeacher);
                                    const classHead = app.teachers.find(t => t.id === cls.classHead);
                                    return `
                                        <tr>
                                            <td>${cls.grade}</td>
                                            <td>${cls.section}</td>
                                            <td>${classTeacher ? classTeacher.name : 'Not Assigned'}</td>
                                            <td>${classHead ? classHead.name : 'Not Assigned'}</td>
                                            <td>${cls.roomNumber}</td>
                                            <td>${cls.students.length}</td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewClass('${cls.id}')">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-warning me-1" onclick="editClass('${cls.id}')">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" onclick="deleteClass('${cls.id}')">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Class Modal -->
                <div class="modal fade" id="addClassModal" tabindex="-1" aria-labelledby="addClassModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addClassModalLabel">Add New Class</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addClassForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="classGrade" class="form-label">Grade</label>
                                            <select class="form-select" id="classGrade" required>
                                                ${Array.from({length: 12}, (_, i) => i + 1).map(grade => 
                                                    `<option value="${grade}">Class ${grade}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="classSection" class="form-label">Section</label>
                                            <select class="form-select" id="classSection" required>
                                                <option value="A">Section A</option>
                                                <option value="B">Section B</option>
                                                <option value="C">Section C</option>
                                                <option value="D">Section D</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="classTeacher" class="form-label">Class Teacher</label>
                                            <select class="form-select" id="classTeacher" required>
                                                ${app.teachers.map(teacher => 
                                                    `<option value="${teacher.id}">${teacher.name} (${teacher.subject})</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="classHead" class="form-label">Class Head</label>
                                            <select class="form-select" id="classHead" required>
                                                ${app.teachers.map(teacher => 
                                                    `<option value="${teacher.id}">${teacher.name} (${teacher.subject})</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="roomNumber" class="form-label">Room Number</label>
                                        <input type="text" class="form-control" id="roomNumber" required>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveClass()">Save Class</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listener for filter
            document.getElementById('classGradeFilter').addEventListener('change', filterClasses);
        }

        function loadAttendance() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Attendance Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('attendance')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#markAttendanceModal">
                                <i class="bi bi-check2-square me-2"></i>Mark Attendance
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="attendanceClassFilter">
                            <option value="">Select Class</option>
                            ${app.classes.map(cls => 
                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                            ).join('')}
                        </select>
                        <input type="date" class="form-control" id="attendanceDateFilter" value="${new Date().toISOString().split('T')[0]}">
                        <select class="form-select" id="attendanceStatusFilter">
                            <option value="">All Status</option>
                            <option value="present">Present</option>
                            <option value="absent">Absent</option>
                            <option value="late">Late</option>
                        </select>
                    </div>
                    <div class="attendance-grid" id="attendanceGrid">
                        <!-- Attendance items will be populated here -->
                    </div>
                </div>
                
                <!-- Mark Attendance Modal -->
                <div class="modal fade" id="markAttendanceModal" tabindex="-1" aria-labelledby="markAttendanceModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="markAttendanceModalLabel">Mark Attendance</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="attendanceClass" class="form-label">Class</label>
                                        <select class="form-select" id="attendanceClass" required>
                                            ${app.classes.map(cls => 
                                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="attendanceDate" class="form-label">Date</label>
                                        <input type="date" class="form-control" id="attendanceDate" value="${new Date().toISOString().split('T')[0]}" required>
                                    </div>
                                </div>
                                <div id="attendanceStudentsList">
                                    <!-- Students list will be populated here -->
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveAttendance()">Save Attendance</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners
            document.getElementById('attendanceClassFilter').addEventListener('change', loadAttendanceData);
            document.getElementById('attendanceDateFilter').addEventListener('change', loadAttendanceData);
            document.getElementById('attendanceStatusFilter').addEventListener('change', loadAttendanceData);
            document.getElementById('attendanceClass').addEventListener('change', loadStudentsForAttendance);
            
            // Load initial data
            loadAttendanceData();
            loadStudentsForAttendance();
        }

        function loadMarks() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Marks Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('marks')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addMarksModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Marks
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="marksClassFilter">
                            <option value="">Select Class</option>
                            ${app.classes.map(cls => 
                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                            ).join('')}
                        </select>
                        <select class="form-select" id="marksExamFilter">
                            <option value="">Select Exam</option>
                            <option value="periodic">Periodic Test</option>
                            <option value="midterm">Mid Term</option>
                            <option value="term">Term Exam</option>
                        </select>
                        <select class="form-select" id="marksSubjectFilter">
                            <option value="">Select Subject</option>
                            ${['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'].map(subject => 
                                `<option value="${subject}">${subject}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Name</th>
                                    <th>Subject</th>
                                    <th>Exam</th>
                                    <th>Marks</th>
                                    <th>Grade</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="marksTableBody">
                                <!-- Marks data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Marks Modal -->
                <div class="modal fade" id="addMarksModal" tabindex="-1" aria-labelledby="addMarksModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addMarksModalLabel">Add Marks</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="marksClass" class="form-label">Class</label>
                                        <select class="form-select" id="marksClass" required>
                                            ${app.classes.map(cls => 
                                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="marksExam" class="form-label">Exam</label>
                                        <select class="form-select" id="marksExam" required>
                                            <option value="periodic">Periodic Test</option>
                                            <option value="midterm">Mid Term</option>
                                            <option value="term">Term Exam</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="marksSubject" class="form-label">Subject</label>
                                        <select class="form-select" id="marksSubject" required>
                                            ${['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'].map(subject => 
                                                `<option value="${subject}">${subject}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="maxMarks" class="form-label">Maximum Marks</label>
                                        <input type="number" class="form-control" id="maxMarks" value="100" required>
                                    </div>
                                </div>
                                <div id="marksStudentsList">
                                    <!-- Students list will be populated here -->
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveMarks()">Save Marks</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners
            document.getElementById('marksClassFilter').addEventListener('change', loadMarksData);
            document.getElementById('marksExamFilter').addEventListener('change', loadMarksData);
            document.getElementById('marksSubjectFilter').addEventListener('change', loadMarksData);
            document.getElementById('marksClass').addEventListener('change', loadStudentsForMarks);
            
            // Load initial data
            loadMarksData();
            loadStudentsForMarks();
        }

        function loadTimetable() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Timetable Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('timetable')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#editTimetableModal">
                                <i class="bi bi-pencil-square me-2"></i>Edit Timetable
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="timetableClassFilter">
                            <option value="">Select Class</option>
                            ${app.classes.map(cls => 
                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="tab-navigation">
                        <button class="tab-button active" data-day="Monday">Monday</button>
                        <button class="tab-button" data-day="Tuesday">Tuesday</button>
                        <button class="tab-button" data-day="Wednesday">Wednesday</button>
                        <button class="tab-button" data-day="Thursday">Thursday</button>
                        <button class="tab-button" data-day="Friday">Friday</button>
                    </div>
                    <div id="timetableContent">
                        <!-- Timetable content will be populated here -->
                    </div>
                </div>
                
                <!-- Edit Timetable Modal -->
                <div class="modal fade" id="editTimetableModal" tabindex="-1" aria-labelledby="editTimetableModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="editTimetableModalLabel">Edit Timetable</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="timetableClass" class="form-label">Class</label>
                                        <select class="form-select" id="timetableClass" required>
                                            ${app.classes.map(cls => 
                                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="timetableDay" class="form-label">Day</label>
                                        <select class="form-select" id="timetableDay" required>
                                            <option value="Monday">Monday</option>
                                            <option value="Tuesday">Tuesday</option>
                                            <option value="Wednesday">Wednesday</option>
                                            <option value="Thursday">Thursday</option>
                                            <option value="Friday">Friday</option>
                                        </select>
                                    </div>
                                </div>
                                <div id="timetablePeriodsList">
                                    <!-- Periods list will be populated here -->
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveTimetable()">Save Timetable</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners
            document.getElementById('timetableClassFilter').addEventListener('change', loadTimetableData);
            document.getElementById('timetableClass').addEventListener('change', loadPeriodsForTimetable);
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    loadTimetableForDay(this.dataset.day);
                });
            });
            
            // Load initial data
            loadTimetableData();
            loadPeriodsForTimetable();
        }

        function loadAnnouncements() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Announcements</h5>
                        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addAnnouncementModal">
                            <i class="bi bi-plus-circle me-2"></i>Add Announcement
                        </button>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="announcementTargetFilter">
                            <option value="">All Targets</option>
                            <option value="all">All School</option>
                            <option value="1-5">Classes 1-5</option>
                            <option value="6-8">Classes 6-8</option>
                            <option value="9-10">Classes 9-10</option>
                            <option value="11-12">Classes 11-12</option>
                        </select>
                        <input type="date" class="form-control" id="announcementDateFilter">
                    </div>
                    <div id="announcementsList">
                        ${app.announcements.map(announcement => `
                            <div class="announcement-card ${announcement.urgent ? 'urgent' : ''}">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6>${announcement.title}</h6>
                                        <p>${announcement.content}</p>
                                        <small>${announcement.date}</small>
                                    </div>
                                    <div>
                                        ${announcement.urgent ? '<span class="badge bg-danger">Urgent</span>' : ''}
                                        <button class="btn btn-sm btn-outline-primary ms-2" onclick="editAnnouncement(${announcement.id})">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger ms-1" onclick="deleteAnnouncement(${announcement.id})">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Add Announcement Modal -->
                <div class="modal fade" id="addAnnouncementModal" tabindex="-1" aria-labelledby="addAnnouncementModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addAnnouncementModalLabel">Add Announcement</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addAnnouncementForm">
                                    <div class="mb-3">
                                        <label for="announcementTitle" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="announcementTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="announcementContent" class="form-label">Content</label>
                                        <textarea class="form-control" id="announcementContent" rows="5" required></textarea>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="announcementTarget" class="form-label">Target</label>
                                            <select class="form-select" id="announcementTarget" required>
                                                <option value="all">All School</option>
                                                <option value="1-5">Classes 1-5</option>
                                                <option value="6-8">Classes 6-8</option>
                                                <option value="9-10">Classes 9-10</option>
                                                <option value="11-12">Classes 11-12</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="announcementDate" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="announcementDate" value="${new Date().toISOString().split('T')[0]}" required>
                                        </div>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="announcementUrgent">
                                        <label class="form-check-label" for="announcementUrgent">
                                            Mark as Urgent
                                        </label>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveAnnouncement()">Save Announcement</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners
            document.getElementById('announcementTargetFilter').addEventListener('change', filterAnnouncements);
            document.getElementById('announcementDateFilter').addEventListener('change', filterAnnouncements);
        }

        function loadEvents() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Events & Programs</h5>
                        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addEventModal">
                            <i class="bi bi-plus-circle me-2"></i>Add Event
                        </button>
                    </div>
                    <div class="row">
                        ${app.events.map(event => `
                            <div class="col-md-4 mb-4">
                                <div class="event-card">
                                    <div class="event-image" style="background-image: url('${event.image}')"></div>
                                    <div class="event-details">
                                        <span class="event-date">${event.date}</span>
                                        <h5>${event.title}</h5>
                                        <p>${event.description}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <i class="bi bi-clock me-1"></i> ${event.time}
                                                <i class="bi bi-geo-alt ms-3 me-1"></i> ${event.location}
                                            </div>
                                            <div>
                                                <button class="btn btn-sm btn-outline-primary" onclick="editEvent(${event.id})">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger ms-1" onclick="deleteEvent(${event.id})">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <!-- Add Event Modal -->
                <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addEventModalLabel">Add Event</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addEventForm">
                                    <div class="mb-3">
                                        <label for="eventTitle" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="eventTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="eventDescription" class="form-label">Description</label>
                                        <textarea class="form-control" id="eventDescription" rows="3" required></textarea>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="eventDate" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="eventDate" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="eventTime" class="form-label">Time</label>
                                            <input type="time" class="form-control" id="eventTime" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="eventLocation" class="form-label">Location</label>
                                        <input type="text" class="form-control" id="eventLocation" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="eventImage" class="form-label">Image URL</label>
                                        <input type="text" class="form-control" id="eventImage" placeholder="https://example.com/image.jpg">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveEvent()">Save Event</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadReports() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Reports Management</h5>
                        <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addReportModal">
                            <i class="bi bi-plus-circle me-2"></i>Add Report
                        </button>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="reportClassFilter">
                            <option value="">Select Class</option>
                            ${app.classes.map(cls => 
                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                            ).join('')}
                        </select>
                        <select class="form-select" id="reportStudentFilter">
                            <option value="">Select Student</option>
                            <!-- Students will be populated based on class selection -->
                        </select>
                        <select class="form-select" id="reportTypeFilter">
                            <option value="">All Types</option>
                            <option value="academic">Academic</option>
                            <option value="behavior">Behavior</option>
                            <option value="health">Health</option>
                            <option value="general">General</option>
                        </select>
                    </div>
                    <div id="reportsList">
                        <!-- Reports will be populated here -->
                    </div>
                </div>
                
                <!-- Add Report Modal -->
                <div class="modal fade" id="addReportModal" tabindex="-1" aria-labelledby="addReportModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addReportModalLabel">Add Report</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addReportForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="reportClass" class="form-label">Class</label>
                                            <select class="form-select" id="reportClass" required>
                                                ${app.classes.map(cls => 
                                                    `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                                                ).join('')}
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="reportStudent" class="form-label">Student</label>
                                            <select class="form-select" id="reportStudent" required>
                                                <!-- Students will be populated based on class selection -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="reportType" class="form-label">Report Type</label>
                                            <select class="form-select" id="reportType" required>
                                                <option value="academic">Academic</option>
                                                <option value="behavior">Behavior</option>
                                                <option value="health">Health</option>
                                                <option value="general">General</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="reportDate" class="form-label">Date</label>
                                            <input type="date" class="form-control" id="reportDate" value="${new Date().toISOString().split('T')[0]}" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="reportTitle" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="reportTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="reportContent" class="form-label">Content</label>
                                        <textarea class="form-control" id="reportContent" rows="5" required></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveReport()">Save Report</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listeners
            document.getElementById('reportClassFilter').addEventListener('change', () => {
                loadStudentsForReportFilter();
                loadReportsData();
            });
            document.getElementById('reportStudentFilter').addEventListener('change', loadReportsData);
            document.getElementById('reportTypeFilter').addEventListener('change', loadReportsData);
            document.getElementById('reportClass').addEventListener('change', loadStudentsForReport);
            
            // Load initial data
            loadStudentsForReportFilter();
            loadStudentsForReport();
            loadReportsData();
        }

        function loadBuses() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Bus Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('buses')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addBusModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Bus
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="busTypeFilter">
                            <option value="">All Types</option>
                            <option value="School">School Bus</option>
                            <option value="Private">Private Bus</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Bus ID</th>
                                    <th>Type</th>
                                    <th>Driver</th>
                                    <th>Driver Phone</th>
                                    <th>Capacity</th>
                                    <th>Route</th>
                                    <th>Students Count</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${app.buses.map(bus => `
                                    <tr>
                                        <td>${bus.id}</td>
                                        <td>${bus.type}</td>
                                        <td>${bus.driver}</td>
                                        <td>${bus.driverPhone}</td>
                                        <td>${bus.capacity}</td>
                                        <td>${bus.route}</td>
                                        <td>${bus.students.length}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewBus('${bus.id}')">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editBus('${bus.id}')">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteBus('${bus.id}')">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Bus Modal -->
                <div class="modal fade" id="addBusModal" tabindex="-1" aria-labelledby="addBusModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addBusModalLabel">Add Bus</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addBusForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="busId" class="form-label">Bus ID</label>
                                            <input type="text" class="form-control" id="busId" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="busType" class="form-label">Type</label>
                                            <select class="form-select" id="busType" required>
                                                <option value="School">School Bus</option>
                                                <option value="Private">Private Bus</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="busDriver" class="form-label">Driver Name</label>
                                            <input type="text" class="form-control" id="busDriver" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="busDriverPhone" class="form-label">Driver Phone</label>
                                            <input type="tel" class="form-control" id="busDriverPhone" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="busCapacity" class="form-label">Capacity</label>
                                            <input type="number" class="form-control" id="busCapacity" min="1" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="busRoute" class="form-label">Route</label>
                                            <input type="text" class="form-control" id="busRoute" required>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveBus()">Save Bus</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Add event listener for filter
            document.getElementById('busTypeFilter').addEventListener('change', filterBuses);
        }

        function loadBusTracking() {
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">Bus Tracking</h5>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <select class="form-select" id="busSelect">
                                <option value="">Select Bus</option>
                                ${app.buses.map(bus => `
                                    <option value="${bus.id}">${bus.id} - ${bus.route}</option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <button class="btn btn-primary-custom" onclick="trackBus()">
                                <i class="bi bi-geo-alt me-2"></i>Track Bus
                            </button>
                        </div>
                    </div>
                    <div id="busMap" class="bus-map"></div>
                    <div id="busInfo" class="mt-3">
                        <!-- Bus information will be displayed here -->
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Initialize map
            setTimeout(() => {
                const map = L.map('busMap').setView([10.9276, 76.9055], 13); // Ettimadai coordinates
                
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // Store map instance for later use
                app.busMap = map;
            }, 100);
        }

        function loadSmartScreen() {
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">Smart Screen Monitor</h5>
                    <div class="smart-screen">
                        <div class="smart-screen-header">
                            <div>Amrita Vidyalayam Ettimadai</div>
                            <div id="currentTime">${new Date().toLocaleTimeString()}</div>
                        </div>
                        <div class="smart-screen-content" id="smartScreenContent">
                            <h2>Welcome to Amrita Vidyalayam</h2>
                            <p class="mt-3">Excellence in Education</p>
                        </div>
                        <div class="smart-screen-controls">
                            <button onclick="showDashboardOnScreen()">Dashboard</button>
                            <button onclick="showAnnouncementsOnScreen()">Announcements</button>
                            <button onclick="showTimetableOnScreen()">Timetable</button>
                            <button onclick="showEventsOnScreen()">Events</button>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Update time every second
            setInterval(() => {
                const timeElement = document.getElementById('currentTime');
                if (timeElement) {
                    timeElement.textContent = new Date().toLocaleTimeString();
                }
            }, 1000);
        }

        function loadLibrary() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Library Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('library')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addBookModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Book
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="bookCategoryFilter">
                            <option value="">All Categories</option>
                            <option value="Fiction">Fiction</option>
                            <option value="Non-Fiction">Non-Fiction</option>
                            <option value="Reference">Reference</option>
                            <option value="Textbook">Textbook</option>
                            <option value="Magazine">Magazine</option>
                        </select>
                        <input type="text" class="form-control" id="searchBook" placeholder="Search by title or author">
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Book ID</th>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Category</th>
                                    <th>Available</th>
                                    <th>Issued To</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Sample books data -->
                                <tr>
                                    <td>B001</td>
                                    <td>The Great Gatsby</td>
                                    <td>F. Scott Fitzgerald</td>
                                    <td>Fiction</td>
                                    <td><span class="badge bg-success">Available</span></td>
                                    <td>-</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success me-1">
                                            <i class="bi bi-box-arrow-up-right"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>B002</td>
                                    <td>To Kill a Mockingbird</td>
                                    <td>Harper Lee</td>
                                    <td>Fiction</td>
                                    <td><span class="badge bg-danger">Issued</span></td>
                                    <td>STU0001</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1">
                                            <i class="bi bi-box-arrow-in-down"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Book Modal -->
                <div class="modal fade" id="addBookModal" tabindex="-1" aria-labelledby="addBookModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addBookModalLabel">Add Book</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addBookForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="bookTitle" class="form-label">Title</label>
                                            <input type="text" class="form-control" id="bookTitle" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bookAuthor" class="form-label">Author</label>
                                            <input type="text" class="form-control" id="bookAuthor" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="bookCategory" class="form-label">Category</label>
                                            <select class="form-select" id="bookCategory" required>
                                                <option value="Fiction">Fiction</option>
                                                <option value="Non-Fiction">Non-Fiction</option>
                                                <option value="Reference">Reference</option>
                                                <option value="Textbook">Textbook</option>
                                                <option value="Magazine">Magazine</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bookISBN" class="form-label">ISBN</label>
                                            <input type="text" class="form-control" id="bookISBN">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="bookQuantity" class="form-label">Quantity</label>
                                            <input type="number" class="form-control" id="bookQuantity" min="1" value="1" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="bookLocation" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="bookLocation" placeholder="e.g., Shelf A, Row 3">
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveBook()">Save Book</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadInventory() {
            const content = `
                <div class="content-card">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Inventory Management</h5>
                        <div>
                            <button class="btn btn-primary-custom me-2" onclick="exportData('inventory')">
                                <i class="bi bi-download me-2"></i>Export CSV
                            </button>
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#addItemModal">
                                <i class="bi bi-plus-circle me-2"></i>Add Item
                            </button>
                        </div>
                    </div>
                    <div class="filter-container mb-3">
                        <select class="form-select" id="itemCategoryFilter">
                            <option value="">All Categories</option>
                            <option value="Furniture">Furniture</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Stationery">Stationery</option>
                            <option value="Sports">Sports Equipment</option>
                            <option value="Lab">Lab Equipment</option>
                        </select>
                        <select class="form-select" id="itemStatusFilter">
                            <option value="">All Status</option>
                            <option value="Available">Available</option>
                            <option value="In Use">In Use</option>
                            <option value="Maintenance">Under Maintenance</option>
                            <option value="Damaged">Damaged</option>
                        </select>
                        <input type="text" class="form-control" id="searchItem" placeholder="Search by name or ID">
                    </div>
                    <div class="table-container">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>Item ID</th>
                                    <th>Name</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Location</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Sample inventory data -->
                                <tr>
                                    <td>ITM001</td>
                                    <td>Projector</td>
                                    <td>Electronics</td>
                                    <td>5</td>
                                    <td><span class="badge bg-success">Available</span></td>
                                    <td>AV Room</td>
                                    <td>2023-07-15</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>ITM002</td>
                                    <td>Desk</td>
                                    <td>Furniture</td>
                                    <td>120</td>
                                    <td><span class="badge bg-warning">In Use</span></td>
                                    <td>Classrooms</td>
                                    <td>2023-07-10</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-1">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Add Item Modal -->
                <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addItemModalLabel">Add Item</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="addItemForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="itemName" class="form-label">Item Name</label>
                                            <input type="text" class="form-control" id="itemName" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="itemCategory" class="form-label">Category</label>
                                            <select class="form-select" id="itemCategory" required>
                                                <option value="Furniture">Furniture</option>
                                                <option value="Electronics">Electronics</option>
                                                <option value="Stationery">Stationery</option>
                                                <option value="Sports">Sports Equipment</option>
                                                <option value="Lab">Lab Equipment</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="itemQuantity" class="form-label">Quantity</label>
                                            <input type="number" class="form-control" id="itemQuantity" min="1" value="1" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="itemStatus" class="form-label">Status</label>
                                            <select class="form-select" id="itemStatus" required>
                                                <option value="Available">Available</option>
                                                <option value="In Use">In Use</option>
                                                <option value="Maintenance">Under Maintenance</option>
                                                <option value="Damaged">Damaged</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="itemLocation" class="form-label">Location</label>
                                            <input type="text" class="form-control" id="itemLocation" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="itemPurchaseDate" class="form-label">Purchase Date</label>
                                            <input type="date" class="form-control" id="itemPurchaseDate" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="itemDescription" class="form-label">Description</label>
                                        <textarea class="form-control" id="itemDescription" rows="3"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom" onclick="saveItem()">Save Item</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadSettings() {
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">System Settings</h5>
                    <div class="tab-navigation">
                        <button class="tab-button active" data-tab="general">General</button>
                        <button class="tab-button" data-tab="academic">Academic</button>
                        <button class="tab-button" data-tab="notifications">Notifications</button>
                        <button class="tab-button" data-tab="backup">Backup</button>
                    </div>
                    <div class="tab-content active" id="general-tab">
                        <form>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="schoolName" class="form-label">School Name</label>
                                    <input type="text" class="form-control" id="schoolName" value="Amrita Vidyalayam Ettimadai">
                                </div>
                                <div class="col-md-6">
                                    <label for="schoolAddress" class="form-label">School Address</label>
                                    <input type="text" class="form-control" id="schoolAddress" value="Ettimadai, Coimbatore">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="schoolPhone" class="form-label">School Phone</label>
                                    <input type="tel" class="form-control" id="schoolPhone" value="0422-2655000">
                                </div>
                                <div class="col-md-6">
                                    <label for="schoolEmail" class="form-label">School Email</label>
                                    <input type="email" class="form-control" id="schoolEmail" value="info@amrita.edu">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="schoolLogo" class="form-label">School Logo</label>
                                <input type="file" class="form-control" id="schoolLogo">
                            </div>
                            <button type="button" class="btn btn-primary-custom">Save Changes</button>
                        </form>
                    </div>
                    <div class="tab-content" id="academic-tab">
                        <form>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="academicYear" class="form-label">Current Academic Year</label>
                                    <input type="text" class="form-control" id="academicYear" value="2023-2024">
                                </div>
                                <div class="col-md-6">
                                    <label for="termStart" class="form-label">Term Start Date</label>
                                    <input type="date" class="form-control" id="termStart" value="2023-06-01">
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="termEnd" class="form-label">Term End Date</label>
                                    <input type="date" class="form-control" id="termEnd" value="2024-04-30">
                                </div>
                                <div class="col-md-6">
                                    <label for="workingDays" class="form-label">Working Days</label>
                                    <input type="text" class="form-control" id="workingDays" value="Monday - Friday">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="schoolTimings" class="form-label">School Timings</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="time" class="form-control" id="schoolStart" value="09:00">
                                    </div>
                                    <div class="col-md-6">
                                        <input type="time" class="form-control" id="schoolEnd" value="15:15">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary-custom">Save Changes</button>
                        </form>
                    </div>
                    <div class="tab-content" id="notifications-tab">
                        <form>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                                    <label class="form-check-label" for="emailNotifications">
                                        Email Notifications
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="smsNotifications" checked>
                                    <label class="form-check-label" for="smsNotifications">
                                        SMS Notifications
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="attendanceAlerts" checked>
                                    <label class="form-check-label" for="attendanceAlerts">
                                        Attendance Alerts
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="examNotifications" checked>
                                    <label class="form-check-label" for="examNotifications">
                                        Exam Notifications
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="feeReminders">
                                    <label class="form-check-label" for="feeReminders">
                                        Fee Reminders
                                    </label>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary-custom">Save Changes</button>
                        </form>
                    </div>
                    <div class="tab-content" id="backup-tab">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="content-card">
                                    <h6>Backup Database</h6>
                                    <p class="text-muted">Create a backup of all system data</p>
                                    <button class="btn btn-primary-custom">Create Backup</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="content-card">
                                    <h6>Restore Database</h6>
                                    <p class="text-muted">Restore system from a backup file</p>
                                    <input type="file" class="form-control mb-2">
                                    <button class="btn btn-primary-custom">Restore Backup</button>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="content-card">
                                    <h6>Backup History</h6>
                                    <div class="table-container">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Date</th>
                                                    <th>File Name</th>
                                                    <th>Size</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>2023-07-15</td>
                                                    <td>backup_20230715.sql</td>
                                                    <td>2.5 MB</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary">Download</button>
                                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>2023-07-08</td>
                                                    <td>backup_20230708.sql</td>
                                                    <td>2.4 MB</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary">Download</button>
                                                        <button class="btn btn-sm btn-outline-danger">Delete</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                });
            });
        }

        function loadMyClasses() {
            // For teacher role - show classes assigned to the teacher
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">My Classes</h5>
                    <div class="row">
                        ${app.classes.slice(0, 3).map(cls => {
                            const students = app.students.filter(s => s.grade === cls.grade && s.section === cls.section);
                            return `
                                <div class="col-md-4 mb-4">
                                    <div class="content-card">
                                        <h6>Class ${cls.grade}-${cls.section}</h6>
                                        <p>Room: ${cls.roomNumber}</p>
                                        <p>Students: ${students.length}</p>
                                        <div class="d-flex justify-content-between">
                                            <button class="btn btn-sm btn-outline-primary" onclick="viewClassStudents('${cls.id}')">
                                                <i class="bi bi-people me-1"></i>Students
                                            </button>
                                            <button class="btn btn-sm btn-outline-success" onclick="markClassAttendance('${cls.id}')">
                                                <i class="bi bi-check2-square me-1"></i>Attendance
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadCommunication() {
            // For teacher role - communication with parents
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">Communication</h5>
                    <div class="tab-navigation">
                        <button class="tab-button active" data-tab="messages">Messages</button>
                        <button class="tab-button" data-tab="calls">Calls</button>
                        <button class="tab-button" data-tab="announcements">Announcements</button>
                    </div>
                    <div class="tab-content active" id="messages-tab">
                        <div class="mb-3">
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#sendMessageModal">
                                <i class="bi bi-envelope me-2"></i>Send Message
                            </button>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Parent of Student 1</h6>
                                    <small>2 hours ago</small>
                                </div>
                                <p class="mb-1">Thank you for the update on my child's progress.</p>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Parent of Student 2</h6>
                                    <small>Yesterday</small>
                                </div>
                                <p class="mb-1">Can you please provide more details about the upcoming project?</p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="calls-tab">
                        <div class="mb-3">
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#makeCallModal">
                                <i class="bi bi-telephone me-2"></i>Make Call
                            </button>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Parent of Student 3</h6>
                                    <small>Today, 10:30 AM</small>
                                </div>
                                <p class="mb-1">Discussed student's performance in mathematics</p>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Parent of Student 4</h6>
                                    <small>Yesterday, 2:15 PM</small>
                                </div>
                                <p class="mb-1">Follow-up on attendance issues</p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="announcements-tab">
                        <div class="mb-3">
                            <button class="btn btn-primary-custom" data-bs-toggle="modal" data-bs-target="#createClassAnnouncementModal">
                                <i class="bi bi-megaphone me-2"></i>Create Announcement
                            </button>
                        </div>
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Math Test Tomorrow</h6>
                                    <small>2 days ago</small>
                                </div>
                                <p class="mb-1">Please remind students to bring their geometry boxes for tomorrow's test.</p>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Project Submission</h6>
                                    <small>1 week ago</small>
                                </div>
                                <p class="mb-1">Science projects are due next Friday. Please ensure students submit on time.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Send Message Modal -->
                <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-labelledby="sendMessageModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="sendMessageModalLabel">Send Message</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="messageRecipient" class="form-label">Recipient</label>
                                        <select class="form-select" id="messageRecipient">
                                            <option value="">Select Parent</option>
                                            ${app.students.slice(0, 10).map(student => `
                                                <option value="${student.id}">Parent of ${student.name}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="messageSubject" class="form-label">Subject</label>
                                        <input type="text" class="form-control" id="messageSubject">
                                    </div>
                                    <div class="mb-3">
                                        <label for="messageContent" class="form-label">Message</label>
                                        <textarea class="form-control" id="messageContent" rows="5"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom">Send Message</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Make Call Modal -->
                <div class="modal fade" id="makeCallModal" tabindex="-1" aria-labelledby="makeCallModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="makeCallModalLabel">Make Call</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="callRecipient" class="form-label">Recipient</label>
                                        <select class="form-select" id="callRecipient">
                                            <option value="">Select Parent</option>
                                            ${app.students.slice(0, 10).map(student => `
                                                <option value="${student.id}">Parent of ${student.name} (${student.parentPhone})</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="callNotes" class="form-label">Call Notes</label>
                                        <textarea class="form-control" id="callNotes" rows="5" placeholder="Purpose of call and discussion points"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom">
                                    <i class="bi bi-telephone me-2"></i>Make Call
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Create Class Announcement Modal -->
                <div class="modal fade" id="createClassAnnouncementModal" tabindex="-1" aria-labelledby="createClassAnnouncementModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="createClassAnnouncementModalLabel">Create Announcement</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <label for="classAnnouncementTitle" class="form-label">Title</label>
                                        <input type="text" class="form-control" id="classAnnouncementTitle">
                                    </div>
                                    <div class="mb-3">
                                        <label for="classAnnouncementContent" class="form-label">Content</label>
                                        <textarea class="form-control" id="classAnnouncementContent" rows="5"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="classAnnouncementTarget" class="form-label">Target</label>
                                        <select class="form-select" id="classAnnouncementTarget">
                                            <option value="all">All Classes</option>
                                            ${app.classes.slice(0, 3).map(cls => 
                                                `<option value="${cls.id}">Class ${cls.grade}-${cls.section}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary-custom">Create Announcement</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                });
            });
        }

        function loadMyDetails() {
            // For student role - show student's personal details
            const student = app.students[0]; // Get first student for demo
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">My Details</h5>
                    <div class="row">
                        <div class="col-md-4 text-center mb-4">
                            <img src="https://picsum.photos/seed/${student.id}/200/200.jpg" alt="Profile" class="profile-avatar mb-3">
                            <h5>${student.name}</h5>
                            <p>Class ${student.grade}-${student.section}</p>
                            <p>ID: ${student.id}</p>
                        </div>
                        <div class="col-md-8">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Email:</strong> ${student.email}
                                </div>
                                <div class="col-md-6">
                                    <strong>Phone:</strong> ${student.phone}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Date of Birth:</strong> ${student.dob}
                                </div>
                                <div class="col-md-6">
                                    <strong>Blood Group:</strong> ${student.bloodGroup}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Gender:</strong> ${student.gender}
                                </div>
                                <div class="col-md-6">
                                    <strong>Admission Date:</strong> ${student.admissionDate}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-12">
                                    <strong>Address:</strong> ${student.address}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Parent Email:</strong> ${student.parentEmail}
                                </div>
                                <div class="col-md-6">
                                    <strong>Parent Phone:</strong> ${student.parentPhone}
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <strong>Transport:</strong> ${student.transport}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
        }

        function loadAssignments() {
            // For student role - show assignments
            const content = `
                <div class="content-card">
                    <h5 class="mb-3">My Assignments</h5>
                    <div class="tab-navigation">
                        <button class="tab-button active" data-tab="pending">Pending</button>
                        <button class="tab-button" data-tab="submitted">Submitted</button>
                        <button class="tab-button" data-tab="graded">Graded</button>
                    </div>
                    <div class="tab-content active" id="pending-tab">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Mathematics Assignment</h6>
                                    <small>Due: 2023-07-20</small>
                                </div>
                                <p class="mb-1">Complete exercises 1-20 from Chapter 5</p>
                                <button class="btn btn-sm btn-primary-custom">Submit Assignment</button>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Science Project</h6>
                                    <small>Due: 2023-07-25</small>
                                </div>
                                <p class="mb-1">Create a model of the solar system</p>
                                <button class="btn btn-sm btn-primary-custom">Submit Assignment</button>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="submitted-tab">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">English Essay</h6>
                                    <small>Submitted: 2023-07-10</small>
                                </div>
                                <p class="mb-1">Essay on "My Favorite Book"</p>
                                <span class="badge bg-warning">Pending Review</span>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" id="graded-tab">
                        <div class="list-group">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">History Quiz</h6>
                                    <small>Graded: 2023-07-05</small>
                                </div>
                                <p class="mb-1">Quiz on Ancient Civilizations</p>
                                <span class="badge bg-success">Grade: A</span>
                                <span class="badge bg-info">Score: 18/20</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            pageContent.innerHTML = content;
            
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                });
            });
        }

        // Helper functions
        function filterStudents() {
            const gradeFilter = document.getElementById('gradeFilter').value;
            const sectionFilter = document.getElementById('sectionFilter').value;
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            
            const filteredStudents = app.students.filter(student => {
                const matchGrade = !gradeFilter || student.grade == gradeFilter;
                const matchSection = !sectionFilter || student.section === sectionFilter;
                const matchSearch = !searchTerm || 
                    student.name.toLowerCase().includes(searchTerm) || 
                    student.id.toLowerCase().includes(searchTerm);
                
                return matchGrade && matchSection && matchSearch;
            });
            
            // Update table with filtered results
            const tbody = document.querySelector('#studentsPage tbody');
            if (tbody) {
                tbody.innerHTML = filteredStudents.map(student => `
                    <tr>
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.grade}</td>
                        <td>${student.section}</td>
                        <td>${student.email}</td>
                        <td>${student.phone}</td>
                        <td>${student.transport}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewStudent('${student.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editStudent('${student.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteStudent('${student.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function filterTeachers() {
            const subjectFilter = document.getElementById('subjectFilter').value;
            const searchTerm = document.getElementById('searchTeacher').value.toLowerCase();
            
            const filteredTeachers = app.teachers.filter(teacher => {
                const matchSubject = !subjectFilter || teacher.subject === subjectFilter;
                const matchSearch = !searchTerm || 
                    teacher.name.toLowerCase().includes(searchTerm) || 
                    teacher.id.toLowerCase().includes(searchTerm);
                
                return matchSubject && matchSearch;
            });
            
            // Update table with filtered results
            const tbody = document.querySelector('#teachersPage tbody');
            if (tbody) {
                tbody.innerHTML = filteredTeachers.map(teacher => `
                    <tr>
                        <td>${teacher.id}</td>
                        <td>${teacher.name}</td>
                        <td>${teacher.subject}</td>
                        <td>${teacher.email}</td>
                        <td>${teacher.phone}</td>
                        <td>${teacher.qualification}</td>
                        <td>${teacher.experience} years</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewTeacher('${teacher.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editTeacher('${teacher.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTeacher('${teacher.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function filterClasses() {
            const gradeFilter = document.getElementById('classGradeFilter').value;
            
            const filteredClasses = app.classes.filter(cls => {
                return !gradeFilter || cls.grade == gradeFilter;
            });
            
            // Update table with filtered results
            const tbody = document.querySelector('#classesPage tbody');
            if (tbody) {
                tbody.innerHTML = filteredClasses.map(cls => {
                    const classTeacher = app.teachers.find(t => t.id === cls.classTeacher);
                    const classHead = app.teachers.find(t => t.id === cls.classHead);
                    return `
                        <tr>
                            <td>${cls.grade}</td>
                            <td>${cls.section}</td>
                            <td>${classTeacher ? classTeacher.name : 'Not Assigned'}</td>
                            <td>${classHead ? classHead.name : 'Not Assigned'}</td>
                            <td>${cls.roomNumber}</td>
                            <td>${cls.students.length}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary me-1" onclick="viewClass('${cls.id}')">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning me-1" onclick="editClass('${cls.id}')">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteClass('${cls.id}')">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function filterBuses() {
            const typeFilter = document.getElementById('busTypeFilter').value;
            
            const filteredBuses = app.buses.filter(bus => {
                return !typeFilter || bus.type === typeFilter;
            });
            
            // Update table with filtered results
            const tbody = document.querySelector('#busesPage tbody');
            if (tbody) {
                tbody.innerHTML = filteredBuses.map(bus => `
                    <tr>
                        <td>${bus.id}</td>
                        <td>${bus.type}</td>
                        <td>${bus.driver}</td>
                        <td>${bus.driverPhone}</td>
                        <td>${bus.capacity}</td>
                        <td>${bus.route}</td>
                        <td>${bus.students.length}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="viewBus('${bus.id}')">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-warning me-1" onclick="editBus('${bus.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteBus('${bus.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function filterAnnouncements() {
            const targetFilter = document.getElementById('announcementTargetFilter').value;
            const dateFilter = document.getElementById('announcementDateFilter').value;
            
            const filteredAnnouncements = app.announcements.filter(announcement => {
                const matchTarget = !targetFilter || announcement.target === targetFilter;
                const matchDate = !dateFilter || announcement.date === dateFilter;
                
                return matchTarget && matchDate;
            });
            
            // Update list with filtered results
            const announcementsList = document.getElementById('announcementsList');
            if (announcementsList) {
                announcementsList.innerHTML = filteredAnnouncements.map(announcement => `
                    <div class="announcement-card ${announcement.urgent ? 'urgent' : ''}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6>${announcement.title}</h6>
                                <p>${announcement.content}</p>
                                <small>${announcement.date}</small>
                            </div>
                            <div>
                                ${announcement.urgent ? '<span class="badge bg-danger">Urgent</span>' : ''}
                                <button class="btn btn-sm btn-outline-primary ms-2" onclick="editAnnouncement(${announcement.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger ms-1" onclick="deleteAnnouncement(${announcement.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadAttendanceData() {
            const classFilter = document.getElementById('attendanceClassFilter').value;
            const dateFilter = document.getElementById('attendanceDateFilter').value;
            const statusFilter = document.getElementById('attendanceStatusFilter').value;
            
            let students = [];
            if (classFilter) {
                const cls = app.classes.find(c => c.id === classFilter);
                if (cls) {
                    students = app.students.filter(s => cls.students.includes(s.id));
                }
            } else {
                students = app.students.slice(0, 20); // Show first 20 students if no class selected
            }
            
            // Generate random attendance data for demo
            const attendanceData = students.map(student => {
                const status = Math.random() > 0.1 ? 'present' : (Math.random() > 0.5 ? 'absent' : 'late');
                return {
                    student: student,
                    status: status,
                    date: dateFilter || new Date().toISOString().split('T')[0]
                };
            });
            
            // Filter by status if selected
            const filteredData = statusFilter ? 
                attendanceData.filter(a => a.status === statusFilter) : 
                attendanceData;
            
            // Update attendance grid
            const attendanceGrid = document.getElementById('attendanceGrid');
            if (attendanceGrid) {
                attendanceGrid.innerHTML = filteredData.map(data => `
                    <div class="attendance-item ${data.status}" onclick="toggleAttendanceStatus('${data.student.id}')">
                        <div>${data.student.name}</div>
                        <div>${data.student.id}</div>
                        <div class="mt-2">
                            ${data.status === 'present' ? '<i class="bi bi-check-circle text-success"></i>' : 
                              data.status === 'absent' ? '<i class="bi bi-x-circle text-danger"></i>' : 
                              '<i class="bi bi-clock text-warning"></i>'}
                            ${data.status.charAt(0).toUpperCase() + data.status.slice(1)}
                        </div>
                    </div>
                `).join('');
            }
        }

        function loadStudentsForAttendance() {
            const classId = document.getElementById('attendanceClass').value;
            const studentsList = document.getElementById('attendanceStudentsList');
            
            if (classId) {
                const cls = app.classes.find(c => c.id === classId);
                if (cls) {
                    const students = app.students.filter(s => cls.students.includes(s.id));
                    studentsList.innerHTML = `
                        <h6 class="mb-3">Mark Attendance for ${students.length} Students</h6>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Student ID</th>
                                        <th>Name</th>
                                        <th>Present</th>
                                        <th>Absent</th>
                                        <th>Late</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${students.map(student => `
                                        <tr>
                                            <td>${student.id}</td>
                                            <td>${student.name}</td>
                                            <td>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="attendance-${student.id}" id="present-${student.id}" value="present" checked>
                                                    <label class="form-check-label" for="present-${student.id}"></label>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="attendance-${student.id}" id="absent-${student.id}" value="absent">
                                                    <label class="form-check-label" for="absent-${student.id}"></label>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="attendance-${student.id}" id="late-${student.id}" value="late">
                                                    <label class="form-check-label" for="late-${student.id}"></label>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            }
        }

        function loadMarksData() {
            const classFilter = document.getElementById('marksClassFilter').value;
            const examFilter = document.getElementById('marksExamFilter').value;
            const subjectFilter = document.getElementById('marksSubjectFilter').value;
            
            let students = [];
            if (classFilter) {
                const cls = app.classes.find(c => c.id === classFilter);
                if (cls) {
                    students = app.students.filter(s => cls.students.includes(s.id));
                }
            } else {
                students = app.students.slice(0, 20); // Show first 20 students if no class selected
            }
            
            // Generate random marks data for demo
            const marksData = students.map(student => {
                const marks = Math.floor(Math.random() * 40) + 60; // Random marks between 60-100
                let grade;
                if (marks >= 90) grade = 'A';
                else if (marks >= 80) grade = 'B';
                else if (marks >= 70) grade = 'C';
                else grade = 'D';
                
                return {
                    student: student,
                    subject: subjectFilter || 'Mathematics',
                    exam: examFilter || 'Term Exam',
                    marks: marks,
                    grade: grade
                };
            });
            
            // Update marks table
            const marksTableBody = document.getElementById('marksTableBody');
            if (marksTableBody) {
                marksTableBody.innerHTML = marksData.map(data => `
                    <tr>
                        <td>${data.student.id}</td>
                        <td>${data.student.name}</td>
                        <td>${data.subject}</td>
                        <td>${data.exam}</td>
                        <td>${data.marks}</td>
                        <td><span class="grade-badge grade-${data.grade}">${data.grade}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editMarks('${data.student.id}')">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteMarks('${data.student.id}')">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function loadStudentsForMarks() {
            const classId = document.getElementById('marksClass').value;
            const studentsList = document.getElementById('marksStudentsList');
            
            if (classId) {
                const cls = app.classes.find(c => c.id === classId);
                if (cls) {
                    const students = app.students.filter(s => cls.students.includes(s.id));
                    studentsList.innerHTML = `
                        <h6 class="mb-3">Enter Marks for ${students.length} Students</h6>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Student ID</th>
                                        <th>Name</th>
                                        <th>Marks</th>
                                        <th>Grade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${students.map(student => `
                                        <tr>
                                            <td>${student.id}</td>
                                            <td>${student.name}</td>
                                            <td>
                                                <input type="number" class="form-control mark-input" id="marks-${student.id}" min="0" max="100" value="85">
                                            </td>
                                            <td id="grade-${student.id}">B</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    // Add event listeners to calculate grades
                    students.forEach(student => {
                        const marksInput = document.getElementById(`marks-${student.id}`);
                        if (marksInput) {
                            marksInput.addEventListener('input', function() {
                                const marks = parseInt(this.value);
                                let grade;
                                if (marks >= 90) grade = 'A';
                                else if (marks >= 80) grade = 'B';
                                else if (marks >= 70) grade = 'C';
                                else grade = 'D';
                                
                                const gradeElement = document.getElementById(`grade-${student.id}`);
                                if (gradeElement) {
                                    gradeElement.textContent = grade;
                                    gradeElement.className = `grade-badge grade-${grade}`;
                                }
                            });
                        }
                    });
                }
            }
        }

        function loadTimetableData() {
            const classFilter = document.getElementById('timetableClassFilter').value;
            
            if (classFilter) {
                const timetable = app.timetables.find(t => t.classId === classFilter);
                if (timetable) {
                    // Load Monday timetable by default
                    loadTimetableForDay('Monday', timetable);
                }
            }
        }

        function loadTimetableForDay(day, timetable) {
            const timetableContent = document.getElementById('timetableContent');
            if (timetableContent) {
                const periods = ['9:00-9:45', '9:45-10:30', '10:45-11:30', '11:30-12:15', '1:00-1:45', '1:45-2:30', '2:30-3:15'];
                
                if (timetable && timetable.timetable && timetable.timetable[day]) {
                    timetableContent.innerHTML = periods.map(period => `
                        <div class="timetable-slot">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${period}</strong>
                                    <div class="mt-1">${timetable.timetable[day][period]}</div>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    timetableContent.innerHTML = periods.map(period => `
                        <div class="timetable-slot">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>${period}</strong>
                                    <div class="mt-1">No class scheduled</div>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function loadPeriodsForTimetable() {
            const classId = document.getElementById('timetableClass').value;
            const periodsList = document.getElementById('timetablePeriodsList');
            
            if (classId) {
                const periods = ['9:00-9:45', '9:45-10:30', '10:45-11:30', '11:30-12:15', '1:00-1:45', '1:45-2:30', '2:30-3:15'];
                const subjects = ['Mathematics', 'Science', 'English', 'Social Studies', 'Computer Science', 'Physics', 'Chemistry', 'Biology', 'Hindi', 'Tamil'];
                
                periodsList.innerHTML = `
                    <h6 class="mb-3">Edit Timetable</h6>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>Subject</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${periods.map(period => `
                                    <tr>
                                        <td>${period}</td>
                                        <td>
                                            <select class="form-select" id="period-${period.replace(':', '-')}">
                                                ${subjects.map(subject => 
                                                    `<option value="${subject}">${subject}</option>`
                                                ).join('')}
                                            </select>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }

        function loadStudentsForReportFilter() {
            const classFilter = document.getElementById('reportClassFilter').value;
            const studentFilter = document.getElementById('reportStudentFilter');
            
            if (studentFilter) {
                studentFilter.innerHTML = '<option value="">Select Student</option>';
                
                if (classFilter) {
                    const cls = app.classes.find(c => c.id === classFilter);
                    if (cls) {
                        const students = app.students.filter(s => cls.students.includes(s.id));
                        students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.id;
                            option.textContent = `${student.name} (${student.id})`;
                            studentFilter.appendChild(option);
                        });
                    }
                }
            }
        }

        function loadStudentsForReport() {
            const classId = document.getElementById('reportClass').value;
            const studentFilter = document.getElementById('reportStudent');
            
            if (studentFilter) {
                studentFilter.innerHTML = '<option value="">Select Student</option>';
                
                if (classId) {
                    const cls = app.classes.find(c => c.id === classId);
                    if (cls) {
                        const students = app.students.filter(s => cls.students.includes(s.id));
                        students.forEach(student => {
                            const option = document.createElement('option');
                            option.value = student.id;
                            option.textContent = `${student.name} (${student.id})`;
                            studentFilter.appendChild(option);
                        });
                    }
                }
            }
        }

        function loadReportsData() {
            const classFilter = document.getElementById('reportClassFilter').value;
            const studentFilter = document.getElementById('reportStudentFilter').value;
            const typeFilter = document.getElementById('reportTypeFilter').value;
            
            // Generate sample reports for demo
            const reports = [
                {
                    id: 1,
                    studentId: 'STU0001',
                    studentName: 'Student 1',
                    type: 'academic',
                    title: 'Academic Performance Report',
                    date: '2023-07-15',
                    content: 'Student is performing well in all subjects. Needs improvement in mathematics.'
                },
                {
                    id: 2,
                    studentId: 'STU0002',
                    studentName: 'Student 2',
                    type: 'behavior',
                    title: 'Behavior Report',
                    date: '2023-07-10',
                    content: 'Student is well-behaved and participates actively in class activities.'
                },
                {
                    id: 3,
                    studentId: 'STU0003',
                    studentName: 'Student 3',
                    type: 'health',
                    title: 'Health Report',
                    date: '2023-07-05',
                    content: 'Student has no health issues. Regular check-up recommended.'
                }
            ];
            
            // Filter reports
            const filteredReports = reports.filter(report => {
                const matchClass = !classFilter || 
                    app.students.some(s => s.id === report.studentId && 
                    app.classes.some(c => c.id === classFilter && c.students.includes(s.id)));
                const matchStudent = !studentFilter || report.studentId === studentFilter;
                const matchType = !typeFilter || report.type === typeFilter;
                
                return matchClass && matchStudent && matchType;
            });
            
            // Update reports list
            const reportsList = document.getElementById('reportsList');
            if (reportsList) {
                reportsList.innerHTML = filteredReports.map(report => `
                    <div class="report-card">
                        <div class="report-header">
                            <div>
                                <h6>${report.title}</h6>
                                <p class="mb-0">${report.studentName} (${report.studentId})</p>
                            </div>
                            <div>
                                <span class="badge bg-info">${report.type}</span>
                                <small class="ms-2">${report.date}</small>
                                <button class="btn btn-sm btn-outline-primary ms-2" onclick="viewReport(${report.id})">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning ms-1" onclick="editReport(${report.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger ms-1" onclick="deleteReport(${report.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p>${report.content}</p>
                        <div class="comment-section">
                            <h6>Comments</h6>
                            <div class="comment">
                                <div class="comment-author">Teacher 1</div>
                                <div class="comment-text">Student has shown improvement.</div>
                                <div class="comment-date">2023-07-16</div>
                            </div>
                            <div class="comment">
                                <div class="comment-author">Parent of ${report.studentName}</div>
                                <div class="comment-text">Thank you for the update.</div>
                                <div class="comment-date">2023-07-17</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function trackBus() {
            const busId = document.getElementById('busSelect').value;
            const busInfo = document.getElementById('busInfo');
            
            if (busId && app.busMap) {
                const bus = app.buses.find(b => b.id === busId);
                
                if (bus) {
                    // Clear existing markers
                    app.busMap.eachLayer(layer => {
                        if (layer instanceof L.Marker) {
                            app.busMap.removeLayer(layer);
                        }
                    });
                    
                    // Generate random coordinates for demo (in a real app, this would come from GPS)
                    const lat = 10.9276 + (Math.random() - 0.5) * 0.05;
                    const lng = 76.9055 + (Math.random() - 0.5) * 0.05;
                    
                    // Add bus marker
                    const busIcon = L.divIcon({
                        html: '<i class="bi bi-bus-front-fill text-primary fs-3"></i>',
                        iconSize: [30, 30],
                        className: 'bus-marker'
                    });
                    
                    const busMarker = L.marker([lat, lng], { icon: busIcon }).addTo(app.busMap);
                    busMarker.bindPopup(`<b>${bus.id}</b><br>${bus.route}<br>Driver: ${bus.driver}`);
                    
                    // Add school marker
                    const schoolIcon = L.divIcon({
                        html: '<i class="bi bi-building text-danger fs-3"></i>',
                        iconSize: [30, 30],
                        className: 'school-marker'
                    });
                    
                    L.marker([10.9276, 76.9055], { icon: schoolIcon }).addTo(app.busMap)
                        .bindPopup('<b>Amrita Vidyalayam</b><br>Ettimadai');
                    
                    // Update bus info
                    busInfo.innerHTML = `
                        <div class="alert alert-info">
                            <h6>Bus Information</h6>
                            <p><strong>Bus ID:</strong> ${bus.id}</p>
                            <p><strong>Route:</strong> ${bus.route}</p>
                            <p><strong>Driver:</strong> ${bus.driver}</p>
                            <p><strong>Driver Phone:</strong> ${bus.driverPhone}</p>
                            <p><strong>Students on Board:</strong> ${bus.students.length}</p>
                            <p><strong>Capacity:</strong> ${bus.capacity}</p>
                            <p><strong>Last Updated:</strong> ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                    
                    // Center map on bus
                    app.busMap.setView([lat, lng], 14);
                }
            }
        }

        function startLocationSharing() {
            const locationStatus = document.getElementById('locationStatus');
            
            if (navigator.geolocation) {
                locationStatus.innerHTML = '<div class="alert alert-info">Getting your location...</div>';
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // Store location in app state
                        app.busLocations[app.currentUser.email] = { lat, lng, timestamp: new Date() };
                        
                        locationStatus.innerHTML = `
                            <div class="alert alert-success">
                                <h6>Location Sharing Started</h6>
                                <p>Your location is now being shared with students and parents.</p>
                                <p><strong>Coordinates:</strong> ${lat.toFixed(6)}, ${lng.toFixed(6)}</p>
                                <p><strong>Last Updated:</strong> ${new Date().toLocaleTimeString()}</p>
                                <button class="btn btn-sm btn-danger mt-2" onclick="stopLocationSharing()">Stop Sharing</button>
                            </div>
                        `;
                        
                        // Update location every 30 seconds
                        app.locationInterval = setInterval(() => {
                            navigator.geolocation.getCurrentPosition(
                                position => {
                                    app.busLocations[app.currentUser.email] = {
                                        lat: position.coords.latitude,
                                        lng: position.coords.longitude,
                                        timestamp: new Date()
                                    };
                                    
                                    locationStatus.querySelector('.alert-success p:last-of-type').textContent = 
                                        `Last Updated: ${new Date().toLocaleTimeString()}`;
                                },
                                error => {
                                    console.error('Error getting location:', error);
                                }
                            );
                        }, 30000);
                    },
                    error => {
                        locationStatus.innerHTML = `
                            <div class="alert alert-danger">
                                <h6>Error</h6>
                                <p>Unable to get your location. Please check your browser settings.</p>
                                <p><strong>Error:</strong> ${error.message}</p>
                            </div>
                        `;
                    }
                );
            } else {
                locationStatus.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>Error</h6>
                        <p>Geolocation is not supported by your browser.</p>
                    </div>
                `;
            }
        }

        function stopLocationSharing() {
            if (app.locationInterval) {
                clearInterval(app.locationInterval);
                app.locationInterval = null;
            }
            
            // Remove location from app state
            delete app.busLocations[app.currentUser.email];
            
            const locationStatus = document.getElementById('locationStatus');
            locationStatus.innerHTML = `
                <div class="alert alert-warning">
                    <h6>Location Sharing Stopped</h6>
                    <p>Your location is no longer being shared.</p>
                </div>
            `;
        }

        function showDashboardOnScreen() {
            const content = document.getElementById('smartScreenContent');
            if (content) {
                content.innerHTML = `
                    <h2>School Dashboard</h2>
                    <div class="row mt-4">
                        <div class="col-6">
                            <div class="text-center">
                                <h3>${app.students.length}</h3>
                                <p>Total Students</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h3>${app.teachers.length}</h3>
                                <p>Total Teachers</p>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-6">
                            <div class="text-center">
                                <h3>${app.classes.length}</h3>
                                <p>Total Classes</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center">
                                <h3>${app.buses.length}</h3>
                                <p>Total Buses</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function showAnnouncementsOnScreen() {
            const content = document.getElementById('smartScreenContent');
            if (content) {
                content.innerHTML = `
                    <h2>Announcements</h2>
                    <div class="mt-4">
                        ${app.announcements.map(announcement => `
                            <div class="mb-4">
                                <h3>${announcement.title}</h3>
                                <p>${announcement.content}</p>
                                <small>${announcement.date}</small>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function showTimetableOnScreen() {
            const content = document.getElementById('smartScreenContent');
            if (content) {
                const timetable = app.timetables[0]; // Get first timetable for demo
                if (timetable && timetable.timetable) {
                    const periods = ['9:00-9:45', '9:45-10:30', '10:45-11:30', '11:30-12:15', '1:00-1:45', '1:45-2:30', '2:30-3:15'];
                    
                    content.innerHTML = `
                        <h2>Today's Timetable</h2>
                        <div class="mt-4">
                            ${periods.map(period => `
                                <div class="mb-3">
                                    <h4>${period}</h4>
                                    <p>${timetable.timetable['Monday'][period]}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            }
        }

        function showEventsOnScreen() {
            const content = document.getElementById('smartScreenContent');
            if (content) {
                content.innerHTML = `
                    <h2>Upcoming Events</h2>
                    <div class="mt-4">
                        ${app.events.map(event => `
                            <div class="mb-4">
                                <h3>${event.title}</h3>
                                <p>${event.description}</p>
                                <p><strong>Date:</strong> ${event.date}</p>
                                <p><strong>Time:</strong> ${event.time}</p>
                                <p><strong>Location:</strong> ${event.location}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }

        function exportData(dataType) {
            let csvContent = '';
            let filename = '';
            
            switch(dataType) {
                case 'students':
                    csvContent = 'ID,Name,Email,Phone,Grade,Section,Parent Email,Parent Phone,Transport,Address,Admission Date,Blood Group,DOB,Gender\n';
                    app.students.forEach(student => {
                        csvContent += `${student.id},${student.name},${student.email},${student.phone},${student.grade},${student.section},${student.parentEmail},${student.parentPhone},${student.transport},${student.address},${student.admissionDate},${student.bloodGroup},${student.dob},${student.gender}\n`;
                    });
                    filename = 'students.csv';
                    break;
                case 'teachers':
                    csvContent = 'ID,Name,Email,Phone,Subject,Qualification,Experience,Address,Join Date\n';
                    app.teachers.forEach(teacher => {
                        csvContent += `${teacher.id},${teacher.name},${teacher.email},${teacher.phone},${teacher.subject},${teacher.qualification},${teacher.experience},${teacher.address},${teacher.joinDate}\n`;
                    });
                    filename = 'teachers.csv';
                    break;
                case 'classes':
                    csvContent = 'ID,Grade,Section,Class Teacher,Class Head,Room Number,Students Count\n';
                    app.classes.forEach(cls => {
                        csvContent += `${cls.id},${cls.grade},${cls.section},${cls.classTeacher},${cls.classHead},${cls.roomNumber},${cls.students.length}\n`;
                    });
                    filename = 'classes.csv';
                    break;
                case 'buses':
                    csvContent = 'ID,Type,Driver,Driver Phone,Capacity,Route,Students Count\n';
                    app.buses.forEach(bus => {
                        csvContent += `${bus.id},${bus.type},${bus.driver},${bus.driverPhone},${bus.capacity},${bus.route},${bus.students.length}\n`;
                    });
                    filename = 'buses.csv';
                    break;
                case 'attendance':
                    csvContent = 'Student ID,Name,Date,Status\n';
                    // Generate sample attendance data
                    app.students.slice(0, 10).forEach(student => {
                        const status = Math.random() > 0.1 ? 'Present' : 'Absent';
                        csvContent += `${student.id},${student.name},${new Date().toISOString().split('T')[0]},${status}\n`;
                    });
                    filename = 'attendance.csv';
                    break;
                case 'marks':
                    csvContent = 'Student ID,Name,Subject,Exam,Marks,Grade\n';
                    // Generate sample marks data
                    app.students.slice(0, 10).forEach(student => {
                        const marks = Math.floor(Math.random() * 40) + 60;
                        let grade;
                        if (marks >= 90) grade = 'A';
                        else if (marks >= 80) grade = 'B';
                        else if (marks >= 70) grade = 'C';
                        else grade = 'D';
                        
                        csvContent += `${student.id},${student.name},Mathematics,Term Exam,${marks},${grade}\n`;
                    });
                    filename = 'marks.csv';
                    break;
                case 'timetable':
                    csvContent = 'Class ID,Day,Period,Subject\n';
                    app.timetables.forEach(timetable => {
                        Object.keys(timetable.timetable).forEach(day => {
                            Object.keys(timetable.timetable[day]).forEach(period => {
                                csvContent += `${timetable.classId},${day},${period},${timetable.timetable[day][period]}\n`;
                            });
                        });
                    });
                    filename = 'timetable.csv';
                    break;
                case 'library':
                    csvContent = 'Book ID,Title,Author,Category,Available,Issued To\n';
                    // Generate sample library data
                    csvContent += 'B001,The Great Gatsby,F. Scott Fitzgerald,Fiction,Yes,-\n';
                    csvContent += 'B002,To Kill a Mockingbird,Harper Lee,Fiction,No,STU0001\n';
                    filename = 'library.csv';
                    break;
                case 'inventory':
                    csvContent = 'Item ID,Name,Category,Quantity,Status,Location,Last Updated\n';
                    // Generate sample inventory data
                    csvContent += 'ITM001,Projector,Electronics,5,Available,AV Room,2023-07-15\n';
                    csvContent += 'ITM002,Desk,Furniture,120,In Use,Classrooms,2023-07-10\n';
                    filename = 'inventory.csv';
                    break;
            }
            
            // Create a blob with the CSV content
            const blob = new Blob([csvContent], { type: 'text/csv' });
            
            // Create a link element and trigger the download
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.className = 'success-message';
            successMessage.style.display = 'block';
            successMessage.textContent = `${filename} has been downloaded successfully.`;
            
            const contentCard = document.querySelector('.content-card');
            if (contentCard) {
                contentCard.insertBefore(successMessage, contentCard.firstChild);
                
                // Hide the message after 3 seconds
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 3000);
            }
        }

        // Mock functions for CRUD operations
        function saveStudent() {
            // In a real application, this would save the student data to a database
            const form = document.getElementById('addStudentForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addStudentModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Student has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveTeacher() {
            // In a real application, this would save the teacher data to a database
            const form = document.getElementById('addTeacherForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addTeacherModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Teacher has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveClass() {
            // In a real application, this would save the class data to a database
            const form = document.getElementById('addClassForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addClassModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Class has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveAttendance() {
            // In a real application, this would save the attendance data to a database
            const form = document.getElementById('addStudentForm');
            const classId = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;
            
            if (classId && date) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('markAttendanceModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Attendance has been marked successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reload attendance data
                loadAttendanceData();
            }
        }

        function saveMarks() {
            // In a real application, this would save the marks data to a database
            const classId = document.getElementById('marksClass').value;
            const exam = document.getElementById('marksExam').value;
            const subject = document.getElementById('marksSubject').value;
            
            if (classId && exam && subject) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addMarksModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Marks have been saved successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reload marks data
                loadMarksData();
            }
        }

        function saveTimetable() {
            // In a real application, this would save the timetable data to a database
            const classId = document.getElementById('timetableClass').value;
            const day = document.getElementById('timetableDay').value;
            
            if (classId && day) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editTimetableModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Timetable has been updated successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reload timetable data
                loadTimetableData();
            }
        }

        function saveAnnouncement() {
            // In a real application, this would save the announcement data to a database
            const form = document.getElementById('addAnnouncementForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addAnnouncementModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Announcement has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveEvent() {
            // In a real application, this would save the event data to a database
            const form = document.getElementById('addEventForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Event has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveReport() {
            // In a real application, this would save the report data to a database
            const form = document.getElementById('addReportForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addReportModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Report has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveBus() {
            // In a real application, this would save the bus data to a database
            const form = document.getElementById('addBusForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addBusModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Bus has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveBook() {
            // In a real application, this would save the book data to a database
            const form = document.getElementById('addBookForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addBookModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Book has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        function saveItem() {
            // In a real application, this would save the item data to a database
            const form = document.getElementById('addItemForm');
            if (form.checkValidity()) {
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addItemModal'));
                modal.hide();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.style.display = 'block';
                successMessage.textContent = 'Item has been added successfully.';
                
                const contentCard = document.querySelector('.content-card');
                if (contentCard) {
                    contentCard.insertBefore(successMessage, contentCard.firstChild);
                    
                    // Hide the message after 3 seconds
                    setTimeout(() => {
                        successMessage.style.display = 'none';
                    }, 3000);
                }
                
                // Reset form
                form.reset();
            } else {
                form.reportValidity();
            }
        }

        // Mock functions for view, edit, delete operations
        function viewStudent(studentId) {
            const student = app.students.find(s => s.id === studentId);
            if (student) {
                alert(`Viewing details for ${student.name}\n\nID: ${student.id}\nGrade: ${student.grade}\nSection: ${student.section}\nEmail: ${student.email}\nPhone: ${student.phone}\nParent Email: ${student.parentEmail}\nParent Phone: ${student.parentPhone}\nTransport: ${student.transport}\nAddress: ${student.address}\nAdmission Date: ${student.admissionDate}\nBlood Group: ${student.bloodGroup}\nDOB: ${student.dob}\nGender: ${student.gender}`);
            }
        }

        function editStudent(studentId) {
            alert(`Edit functionality for student ${studentId} would be implemented here.`);
        }

        function deleteStudent(studentId) {
            if (confirm(`Are you sure you want to delete student ${studentId}?`)) {
                // In a real application, this would delete the student from the database
                alert(`Student ${studentId} has been deleted.`);
                
                // Reload students
                loadStudents();
            }
        }

        function viewTeacher(teacherId) {
            const teacher = app.teachers.find(t => t.id === teacherId);
            if (teacher) {
                alert(`Viewing details for ${teacher.name}\n\nID: ${teacher.id}\nSubject: ${teacher.subject}\nEmail: ${teacher.email}\nPhone: ${teacher.phone}\nQualification: ${teacher.qualification}\nExperience: ${teacher.experience} years\nAddress: ${teacher.address}\nJoin Date: ${teacher.joinDate}`);
            }
        }

        function editTeacher(teacherId) {
            alert(`Edit functionality for teacher ${teacherId} would be implemented here.`);
        }

        function deleteTeacher(teacherId) {
            if (confirm(`Are you sure you want to delete teacher ${teacherId}?`)) {
                // In a real application, this would delete the teacher from the database
                alert(`Teacher ${teacherId} has been deleted.`);
                
                // Reload teachers
                loadTeachers();
            }
        }

        function viewClass(classId) {
            const cls = app.classes.find(c => c.id === classId);
            if (cls) {
                const classTeacher = app.teachers.find(t => t.id === cls.classTeacher);
                const classHead = app.teachers.find(t => t.id === cls.classHead);
                const students = app.students.filter(s => cls.students.includes(s.id));
                
                alert(`Viewing details for Class ${cls.grade}-${cls.section}\n\nRoom: ${cls.roomNumber}\nClass Teacher: ${classTeacher ? classTeacher.name : 'Not Assigned'}\nClass Head: ${classHead ? classHead.name : 'Not Assigned'}\nStudents Count: ${students.length}\n\nStudents:\n${students.map(s => `${s.id} - ${s.name}`).join('\n')}`);
            }
        }

        function editClass(classId) {
            alert(`Edit functionality for class ${classId} would be implemented here.`);
        }

        function deleteClass(classId) {
            if (confirm(`Are you sure you want to delete class ${classId}?`)) {
                // In a real application, this would delete the class from the database
                alert(`Class ${classId} has been deleted.`);
                
                // Reload classes
                loadClasses();
            }
        }

        function viewBus(busId) {
            const bus = app.buses.find(b => b.id === busId);
            if (bus) {
                const students = app.students.filter(s => bus.students.includes(s.id));
                
                alert(`Viewing details for Bus ${bus.id}\n\nType: ${bus.type}\nDriver: ${bus.driver}\nDriver Phone: ${bus.driverPhone}\nCapacity: ${bus.capacity}\nRoute: ${bus.route}\nStudents Count: ${students.length}\n\nStudents:\n${students.map(s => `${s.id} - ${s.name}`).join('\n')}`);
            }
        }

        function editBus(busId) {
            alert(`Edit functionality for bus ${busId} would be implemented here.`);
        }

        function deleteBus(busId) {
            if (confirm(`Are you sure you want to delete bus ${busId}?`)) {
                // In a real application, this would delete the bus from the database
                alert(`Bus ${busId} has been deleted.`);
                
                // Reload buses
                loadBuses();
            }
        }

        function editAnnouncement(announcementId) {
            alert(`Edit functionality for announcement ${announcementId} would be implemented here.`);
        }

        function deleteAnnouncement(announcementId) {
            if (confirm(`Are you sure you want to delete announcement ${announcementId}?`)) {
                // In a real application, this would delete the announcement from the database
                alert(`Announcement ${announcementId} has been deleted.`);
                
                // Reload announcements
                loadAnnouncements();
            }
        }

        function editEvent(eventId) {
            alert(`Edit functionality for event ${eventId} would be implemented here.`);
        }

        function deleteEvent(eventId) {
            if (confirm(`Are you sure you want to delete event ${eventId}?`)) {
                // In a real application, this would delete the event from the database
                alert(`Event ${eventId} has been deleted.`);
                
                // Reload events
                loadEvents();
            }
        }

        function viewReport(reportId) {
            alert(`View functionality for report ${reportId} would be implemented here.`);
        }

        function editReport(reportId) {
            alert(`Edit functionality for report ${reportId} would be implemented here.`);
        }

        function deleteReport(reportId) {
            if (confirm(`Are you sure you want to delete report ${reportId}?`)) {
                // In a real application, this would delete the report from the database
                alert(`Report ${reportId} has been deleted.`);
                
                // Reload reports
                loadReports();
            }
        }

        function editMarks(studentId) {
            alert(`Edit functionality for marks of student ${studentId} would be implemented here.`);
        }

        function deleteMarks(studentId) {
            if (confirm(`Are you sure you want to delete marks for student ${studentId}?`)) {
                // In a real application, this would delete the marks from the database
                alert(`Marks for student ${studentId} have been deleted.`);
                
                // Reload marks
                loadMarksData();
            }
        }

        function toggleAttendanceStatus(studentId) {
            // In a real application, this would update the attendance status in the database
            const attendanceItem = event.currentTarget;
            if (attendanceItem.classList.contains('present')) {
                attendanceItem.classList.remove('present');
                attendanceItem.classList.add('absent');
                attendanceItem.innerHTML = attendanceItem.innerHTML.replace('check-circle text-success', 'x-circle text-danger').replace('Present', 'Absent');
            } else if (attendanceItem.classList.contains('absent')) {
                attendanceItem.classList.remove('absent');
                attendanceItem.classList.add('late');
                attendanceItem.innerHTML = attendanceItem.innerHTML.replace('x-circle text-danger', 'clock text-warning').replace('Absent', 'Late');
            } else {
                attendanceItem.classList.remove('late');
                attendanceItem.classList.add('present');
                attendanceItem.innerHTML = attendanceItem.innerHTML.replace('clock text-warning', 'check-circle text-success').replace('Late', 'Present');
            }
        }

        function viewClassStudents(classId) {
            const cls = app.classes.find(c => c.id === classId);
            if (cls) {
                const students = app.students.filter(s => cls.students.includes(s.id));
                alert(`Students in Class ${cls.grade}-${cls.section}:\n\n${students.map(s => `${s.id} - ${s.name}`).join('\n')}`);
            }
        }

        function markClassAttendance(classId) {
            // Set the class in the attendance modal and open it
            document.getElementById('attendanceClass').value = classId;
            loadStudentsForAttendance();
            
            const modal = new bootstrap.Modal(document.getElementById('markAttendanceModal'));
            modal.show();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sample data
            initializeSampleData();
            
            // Set current time in the login page
            const currentTimeElement = document.createElement('div');
            currentTimeElement.className = 'text-white text-center mt-3';
            currentTimeElement.textContent = new Date().toLocaleString();
            document.querySelector('.login-header').appendChild(currentTimeElement);
            
            // Update time every second
            setInterval(() => {
                if (currentTimeElement) {
                    currentTimeElement.textContent = new Date().toLocaleString();
                }
            }, 1000);
        });
    </script>
</body>
</html>
